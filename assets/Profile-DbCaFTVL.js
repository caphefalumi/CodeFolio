import{_ as X,g as u,o as d,w as r,a as o,i as p,r as n,b as g,c as T,t as f,d as l,h as Y,e as B,F as D,k as j,f as y,l as Z,m as $,n as ee,p as te,j as oe}from"./index-8Zv1DPTr.js";const re={name:"ProfileView",data(){return{userProfile:{},userProjects:[],showEditProfile:!1,showNewProject:!1,loading:!1,isOwner:!1,editForm:{firstName:"",lastName:"",bio:"",avatar:null,avatarPreview:null},successMessage:"",projectForm:{title:"",description:"",content:"",coverImage:null,tags:[],githubUrl:"",type:""},errorMessage:"",projectTypes:["Web Development","Mobile App","API Development","Other"],showResetPassword:!1,resetEmail:"",resetCode:"",resetNewPassword:"",resetConfirmPassword:"",resetStep:1,resetLoading:!1,resetMessage:"",resetError:""}},computed:{accessToken(){return te()}},methods:{async fetchProfileAndProjects(a){var e;try{const i=await Z(a);this.userProfile=i;try{this.currentUser=await $(),this.isOwner=((e=this.currentUser)==null?void 0:e._id)===i._id}catch(v){console.warn("Not logged in or failed to fetch current user:",v),this.currentUser=null,this.isOwner=!1}this.editForm.firstName=i.firstName||"",this.editForm.lastName=i.lastName||"",this.editForm.bio=i.bio,this.editForm.avatar=null,this.editForm.avatarPreview=i.avatar,this.editForm.email=i.email||"",this.userProjects=await ee(a)}catch(i){console.error("Error loading profile or projects:",i)}},onAvatarChange(a){const e=a.target.files[0];e&&(this.editForm.avatar=e,this.editForm.avatarPreview=URL.createObjectURL(e))},async handleProfileUpdate(){var a,e;this.errorMessage="",this.successMessage="",this.loading=!0;try{let i=this.editForm.avatar;if(i&&typeof i=="object"){const t=new FormData;t.append("image",i),i=(await y.post("/api/upload/image/profile",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}else i=this.userProfile.avatar;const v={firstName:this.editForm.firstName,lastName:this.editForm.lastName,bio:this.editForm.bio,avatar:i};await y.patch("/api/users",v,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.successMessage="Profile updated successfully!",this.fetchProfileAndProjects(this.$route.params.username),setTimeout(()=>{this.showEditProfile=!1,this.successMessage=""},1200)}catch(i){this.errorMessage=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message||"Failed to update profile. Please try again."}finally{this.loading=!1}},async saveProject(){this.loading=!0;try{let a=this.projectForm.coverImage;if(a&&typeof a=="object"){const v=new FormData;v.append("image",a),a=(await y.post("/api/upload/image/blog",v,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={title:this.projectForm.title,description:this.projectForm.description,content:this.projectForm.content,coverImage:a,tags:this.projectForm.tags,githubUrl:this.projectForm.githubUrl,type:this.projectForm.type};let i;if(this.projectForm._id){i=await y.patch(`/api/posts/${this.projectForm._id}`,e,{headers:{Authorization:`Bearer ${this.accessToken}`}});const v=i.data.post,t=this.userProjects.findIndex(c=>c._id===v._id);t!==-1&&this.userProjects.splice(t,1,v)}else i=await y.post("/api/posts",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects.push(i.data.post);this.showNewProject=!1,this.resetProjectForm()}catch(a){console.error("Project save failed:",a)}finally{this.loading=!1}},editProject(a){this.projectForm={...a},this.showNewProject=!0},async deleteProject(a){if(confirm("Are you sure you want to delete this project?")){this.loading=!0;try{await y.delete(`/api/posts/${a._id}`,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects=this.userProjects.filter(e=>e._id!==a._id)}catch(e){console.error("Project deletion failed:",e)}finally{this.loading=!1}}},resetProjectForm(){this.projectForm={title:"",description:"",image:null,tags:[],githubUrl:"",type:""}},async handleForgotPassword(){var a,e;this.resetLoading=!0,this.resetError="",this.resetMessage="";try{const i=await y.post("/api/auth/forgot-password",{email:this.resetEmail});this.resetMessage=i.data.message,this.resetStep=2}catch(i){this.resetError=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message}finally{this.resetLoading=!1}},async handleVerifyCode(){var a,e;this.resetLoading=!0,this.resetError="",this.resetMessage="";try{const i=await y.post("/api/auth/verify-reset-code",{email:this.resetEmail,code:this.resetCode});this.resetMessage=i.data.message,this.resetStep=3}catch(i){this.resetError=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message}finally{this.resetLoading=!1}},async handleResetPassword(){var a,e;if(this.resetLoading=!0,this.resetError="",this.resetMessage="",this.resetNewPassword!==this.resetConfirmPassword){this.resetError="Passwords do not match",this.resetLoading=!1;return}try{const i=await y.post("/api/auth/reset-password",{email:this.resetEmail,code:this.resetCode,newPassword:this.resetNewPassword});this.resetMessage=i.data.message,this.resetStep=1}catch(i){this.resetError=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message}finally{this.resetLoading=!1}}},mounted(){const a=this.$route.params.username;this.fetchProfileAndProjects(a)}},se={class:"text-h4 font-weight-bold mb-1"},le={class:"text-subtitle-2 text-grey-darken-1 mb-2"},ie={class:"text-body-1 mb-2"},ae={class:"mb-2"},ne={key:0,class:"mb-2"},de=["href"],ue={class:"d-flex gap-2 mb-2"},me={class:"d-flex gap-2 mt-2"},pe={class:"text-body-2 mb-2"},fe={class:"mb-2"},ce={class:"d-flex flex-column align-center mb-4"};function _e(a,e,i,v,t,c){const x=n("v-img"),L=n("v-avatar"),_=n("v-icon"),N=n("v-chip"),m=n("v-btn"),U=n("v-col"),V=n("v-toolbar-title"),F=n("v-spacer"),k=n("v-toolbar"),O=n("v-card-title"),E=n("v-card-text"),S=n("v-card-actions"),b=n("v-card"),z=n("v-row"),w=n("v-text-field"),M=n("v-textarea"),P=n("v-alert"),h=n("v-form"),I=n("v-container"),R=n("v-dialog"),G=n("v-file-input"),H=n("v-combobox"),W=n("v-select"),A=n("v-stepper-step"),q=n("v-divider"),J=n("v-stepper-header"),K=n("v-stepper"),Q=oe("auto-animate");return d(),u(I,{class:"profile-container py-8"},{default:r(()=>[o(z,{class:"profile-header",align:"center",justify:"center"},{default:r(()=>[o(U,{cols:"12",md:"4",class:"d-flex flex-column align-center"},{default:r(()=>[o(L,{size:"120",class:"profile-avatar elevation-4 mb-4"},{default:r(()=>[o(x,{src:t.userProfile.avatar,cover:""},null,8,["src"])]),_:1}),g("h2",se,f(t.userProfile.firstName+" "+t.userProfile.lastName),1),g("div",le,"@"+f(t.userProfile.username),1),g("div",ie,f(t.userProfile.bio),1),g("div",ae,[o(_,{size:"18",class:"mr-1"},{default:r(()=>e[26]||(e[26]=[l("mdi-email")])),_:1,__:[26]}),l(f(t.userProfile.email),1)]),t.userProfile.githubUrl?(d(),T("div",ne,[o(_,{size:"18",class:"mr-1"},{default:r(()=>e[27]||(e[27]=[l("mdi-github")])),_:1,__:[27]}),g("a",{href:t.userProfile.githubUrl,target:"_blank"},"GitHub",8,de)])):p("",!0),g("div",ue,[o(N,{color:"primary",class:"mr-2",label:""},{default:r(()=>{var s;return[o(_,{left:"",size:"18"},{default:r(()=>e[28]||(e[28]=[l("mdi-account-multiple")])),_:1,__:[28]}),l(" "+f(((s=t.userProfile.followers)==null?void 0:s.length)||0)+" Followers ",1)]}),_:1}),o(N,{color:"secondary",label:""},{default:r(()=>{var s;return[o(_,{left:"",size:"18"},{default:r(()=>e[29]||(e[29]=[l("mdi-account-plus")])),_:1,__:[29]}),l(" "+f(((s=t.userProfile.followed)==null?void 0:s.length)||0)+" Following ",1)]}),_:1})]),g("div",me,[t.isOwner?(d(),u(m,{key:0,color:"primary",variant:"outlined",onClick:e[0]||(e[0]=s=>t.showEditProfile=!0)},{default:r(()=>e[30]||(e[30]=[l("Edit Profile")])),_:1,__:[30]})):p("",!0),t.isOwner?(d(),u(m,{key:1,color:"warning",variant:"outlined",onClick:e[1]||(e[1]=s=>t.showResetPassword=!0)},{default:r(()=>e[31]||(e[31]=[l("Reset Password")])),_:1,__:[31]})):p("",!0)])]),_:1}),o(U,{cols:"12",md:"8"},{default:r(()=>[o(b,{class:"elevation-2 pa-6 profile-projects-card"},{default:r(()=>[o(k,{color:"primary",dark:"",flat:"",class:"rounded-lg mb-4"},{default:r(()=>[o(V,{class:"text-h5"},{default:r(()=>e[32]||(e[32]=[l("My Projects")])),_:1,__:[32]}),o(F),t.isOwner?(d(),u(m,{key:0,color:"white",variant:"text",onClick:e[2]||(e[2]=s=>t.showNewProject=!0)},{default:r(()=>[o(_,{left:""},{default:r(()=>e[33]||(e[33]=[l("mdi-plus")])),_:1,__:[33]}),e[34]||(e[34]=l(" Add New Project "))]),_:1,__:[34]})):p("",!0)]),_:1}),Y((d(),u(z,null,{default:r(()=>[(d(!0),T(D,null,B(t.userProjects,s=>(d(),u(U,{key:s._id,cols:"12",md:"6"},{default:r(()=>[o(b,{class:"project-card elevation-1 mb-4"},{default:r(()=>[o(x,{src:s.coverImage,height:"180",cover:"",class:"rounded-t-lg"},null,8,["src"]),o(O,{class:"font-weight-bold"},{default:r(()=>[l(f(s.title),1)]),_:2},1024),o(E,null,{default:r(()=>[g("div",pe,f(s.description),1),g("div",fe,[(d(!0),T(D,null,B(s.tags,C=>(d(),u(N,{key:C,class:"mr-2 mb-2",size:"small"},{default:r(()=>[l(f(C),1)]),_:2},1024))),128))])]),_:2},1024),o(S,null,{default:r(()=>[o(m,{color:"primary",variant:"text",to:`/${t.userProfile.username}/${s.id}`},{default:r(()=>[o(_,{left:""},{default:r(()=>e[35]||(e[35]=[l("mdi-eye")])),_:1,__:[35]}),e[36]||(e[36]=l(" View "))]),_:2,__:[36]},1032,["to"]),t.isOwner?(d(),u(m,{key:0,color:"primary",variant:"text",onClick:C=>c.editProject(s)},{default:r(()=>[o(_,{left:""},{default:r(()=>e[37]||(e[37]=[l("mdi-pencil")])),_:1,__:[37]}),e[38]||(e[38]=l(" Edit "))]),_:2,__:[38]},1032,["onClick"])):p("",!0),t.isOwner?(d(),u(m,{key:1,color:"error",variant:"text",onClick:C=>c.deleteProject(s)},{default:r(()=>[o(_,{left:""},{default:r(()=>e[39]||(e[39]=[l("mdi-delete")])),_:1,__:[39]}),e[40]||(e[40]=l(" Delete "))]),_:2,__:[40]},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),[[Q]])]),_:1})]),_:1})]),_:1}),o(R,{modelValue:t.showEditProfile,"onUpdate:modelValue":e[10]||(e[10]=s=>t.showEditProfile=s),fullscreen:"",scrollable:"",transition:"dialog-bottom-transition"},{default:r(()=>[o(b,{class:"pa-0",style:{"max-width":"100vw"}},{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[41]||(e[41]=[l("Edit Profile")])),_:1,__:[41]}),o(F),o(m,{icon:"",onClick:e[3]||(e[3]=s=>t.showEditProfile=!1)},{default:r(()=>[o(_,null,{default:r(()=>e[42]||(e[42]=[l("mdi-close")])),_:1,__:[42]})]),_:1})]),_:1}),o(I,{class:"py-6 px-2 px-md-12",style:{"max-width":"600px",margin:"auto"}},{default:r(()=>[g("div",ce,[o(L,{size:"96",class:"mb-2"},{default:r(()=>[o(x,{src:t.editForm.avatarPreview||t.userProfile.avatar,cover:""},null,8,["src"])]),_:1}),o(m,{small:"",color:"primary",variant:"text",onClick:e[4]||(e[4]=s=>a.$refs.avatarInput.click())},{default:r(()=>[o(_,{left:""},{default:r(()=>e[43]||(e[43]=[l("mdi-camera")])),_:1,__:[43]}),e[44]||(e[44]=l(" Change Photo "))]),_:1,__:[44]}),g("input",{ref:"avatarInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[5]||(e[5]=(...s)=>c.onAvatarChange&&c.onAvatarChange(...s))},null,544)]),o(h,{onSubmit:j(c.handleProfileUpdate,["prevent"]),class:"w-100"},{default:r(()=>[o(w,{modelValue:t.editForm.firstName,"onUpdate:modelValue":e[6]||(e[6]=s=>t.editForm.firstName=s),label:"First Name",required:""},null,8,["modelValue"]),o(w,{modelValue:t.editForm.lastName,"onUpdate:modelValue":e[7]||(e[7]=s=>t.editForm.lastName=s),label:"Last Name",required:""},null,8,["modelValue"]),o(w,{modelValue:t.editForm.email,"onUpdate:modelValue":e[8]||(e[8]=s=>t.editForm.email=s),label:"Email",required:"",disabled:""},null,8,["modelValue"]),o(M,{modelValue:t.editForm.bio,"onUpdate:modelValue":e[9]||(e[9]=s=>t.editForm.bio=s),label:"Bio",rows:"3"},null,8,["modelValue"]),t.errorMessage?(d(),u(P,{key:0,type:"error",class:"mt-2"},{default:r(()=>[l(f(t.errorMessage),1)]),_:1})):p("",!0),t.successMessage?(d(),u(P,{key:1,type:"success",class:"mt-2"},{default:r(()=>[l(f(t.successMessage),1)]),_:1})):p("",!0),o(m,{color:"primary",class:"mt-4",type:"submit",block:"",loading:t.loading},{default:r(()=>e[45]||(e[45]=[l("Save Changes")])),_:1,__:[45]},8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(R,{modelValue:t.showNewProject,"onUpdate:modelValue":e[18]||(e[18]=s=>t.showNewProject=s),"max-width":"800"},{default:r(()=>[o(b,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[46]||(e[46]=[l("Add New Project")])),_:1,__:[46]})]),_:1}),o(E,null,{default:r(()=>[o(h,{onSubmit:j(c.saveProject,["prevent"])},{default:r(()=>[o(w,{modelValue:t.projectForm.title,"onUpdate:modelValue":e[11]||(e[11]=s=>t.projectForm.title=s),label:"Project Title",required:""},null,8,["modelValue"]),o(M,{modelValue:t.projectForm.description,"onUpdate:modelValue":e[12]||(e[12]=s=>t.projectForm.description=s),label:"Project Description",required:""},null,8,["modelValue"]),o(M,{modelValue:t.projectForm.content,"onUpdate:modelValue":e[13]||(e[13]=s=>t.projectForm.content=s),label:"Project Content",required:""},null,8,["modelValue"]),o(G,{modelValue:t.projectForm.coverImage,"onUpdate:modelValue":e[14]||(e[14]=s=>t.projectForm.coverImage=s),label:"Project Cover Image",accept:"image/*","prepend-icon":"mdi-image"},null,8,["modelValue"]),o(H,{modelValue:t.projectForm.tags,"onUpdate:modelValue":e[15]||(e[15]=s=>t.projectForm.tags=s),label:"Tags",multiple:"",chips:"","small-chips":""},null,8,["modelValue"]),o(w,{modelValue:t.projectForm.githubUrl,"onUpdate:modelValue":e[16]||(e[16]=s=>t.projectForm.githubUrl=s),label:"GitHub Repository URL","prepend-icon":"mdi-github"},null,8,["modelValue"]),o(W,{modelValue:t.projectForm.type,"onUpdate:modelValue":e[17]||(e[17]=s=>t.projectForm.type=s),items:t.projectTypes,label:"Project Type",required:""},null,8,["modelValue","items"])]),_:1},8,["onSubmit"])]),_:1}),o(S,null,{default:r(()=>[o(F),o(m,{color:"primary",onClick:c.saveProject,loading:t.loading},{default:r(()=>e[47]||(e[47]=[l("Save Project")])),_:1,__:[47]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(R,{modelValue:t.showResetPassword,"onUpdate:modelValue":e[25]||(e[25]=s=>t.showResetPassword=s),"max-width":"420"},{default:r(()=>[o(b,null,{default:r(()=>[o(k,{color:"warning",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[48]||(e[48]=[l("Reset Password")])),_:1,__:[48]})]),_:1}),o(E,null,{default:r(()=>[o(K,{modelValue:t.resetStep,"onUpdate:modelValue":e[19]||(e[19]=s=>t.resetStep=s),flat:"",class:"mb-2"},{default:r(()=>[o(J,null,{default:r(()=>[o(A,{complete:t.resetStep>1,step:"1"},{default:r(()=>e[49]||(e[49]=[l("Email")])),_:1,__:[49]},8,["complete"]),o(q),o(A,{complete:t.resetStep>2,step:"2"},{default:r(()=>e[50]||(e[50]=[l("Code")])),_:1,__:[50]},8,["complete"]),o(q),o(A,{step:"3"},{default:r(()=>e[51]||(e[51]=[l("New Password")])),_:1,__:[51]})]),_:1})]),_:1},8,["modelValue"]),t.resetStep===1?(d(),u(h,{key:0,onSubmit:j(c.handleForgotPassword,["prevent"])},{default:r(()=>[o(w,{modelValue:t.resetEmail,"onUpdate:modelValue":e[20]||(e[20]=s=>t.resetEmail=s),label:"Email",type:"email",required:""},null,8,["modelValue"]),o(m,{color:"primary",type:"submit",loading:t.resetLoading,block:""},{default:r(()=>e[52]||(e[52]=[l("Send Reset Code")])),_:1,__:[52]},8,["loading"])]),_:1},8,["onSubmit"])):p("",!0),t.resetStep===2?(d(),u(h,{key:1,onSubmit:j(c.handleVerifyCode,["prevent"])},{default:r(()=>[o(w,{modelValue:t.resetCode,"onUpdate:modelValue":e[21]||(e[21]=s=>t.resetCode=s),label:"6-digit Code",required:""},null,8,["modelValue"]),o(m,{color:"primary",type:"submit",loading:t.resetLoading,block:""},{default:r(()=>e[53]||(e[53]=[l("Verify Code")])),_:1,__:[53]},8,["loading"])]),_:1},8,["onSubmit"])):p("",!0),t.resetStep===3?(d(),u(h,{key:2,onSubmit:j(c.handleResetPassword,["prevent"])},{default:r(()=>[o(w,{modelValue:t.resetNewPassword,"onUpdate:modelValue":e[22]||(e[22]=s=>t.resetNewPassword=s),label:"New Password",type:"password",required:""},null,8,["modelValue"]),o(w,{modelValue:t.resetConfirmPassword,"onUpdate:modelValue":e[23]||(e[23]=s=>t.resetConfirmPassword=s),label:"Retype New Password",type:"password",required:""},null,8,["modelValue"]),o(m,{color:"primary",type:"submit",loading:t.resetLoading,block:""},{default:r(()=>e[54]||(e[54]=[l("Set New Password")])),_:1,__:[54]},8,["loading"])]),_:1},8,["onSubmit"])):p("",!0),t.resetMessage?(d(),u(P,{key:3,type:"success",class:"mt-2"},{default:r(()=>[l(f(t.resetMessage),1)]),_:1})):p("",!0),t.resetError?(d(),u(P,{key:4,type:"error",class:"mt-2"},{default:r(()=>[l(f(t.resetError),1)]),_:1})):p("",!0)]),_:1}),o(S,null,{default:r(()=>[o(F),o(m,{text:"",onClick:e[24]||(e[24]=s=>t.showResetPassword=!1)},{default:r(()=>e[55]||(e[55]=[l("Close")])),_:1,__:[55]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.errorMessage?(d(),u(P,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:r(()=>[o(_,{color:"error",size:"24"},{default:r(()=>e[56]||(e[56]=[l("mdi-alert-circle")])),_:1,__:[56]})]),default:r(()=>[l(" "+f(t.errorMessage),1)]),_:1})):p("",!0)]),_:1})}const ve=X(re,[["render",_e],["__scopeId","data-v-2b06bfce"]]);export{ve as default};
