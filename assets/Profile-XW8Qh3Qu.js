import{_ as G,c as U,o as d,a as o,g as p,h as g,w as r,r as n,b as w,t as f,d as a,F as E,e as D,i as I,f as _,j as H,k as W,l as J,m as K}from"./index-7GEEXJjE.js";const Q={name:"ProfileView",data(){return{userProfile:{},userProjects:[],showEditProfile:!1,showNewProject:!1,loading:!1,isOwner:!1,editForm:{name:"",bio:"",avatar:null},projectForm:{title:"",description:"",content:"",coverImage:null,tags:[],githubUrl:"",type:""},errorMessage:"",projectTypes:["Web Development","Mobile App","API Development","Other"]}},computed:{accessToken(){return K()}},methods:{async fetchProfileAndProjects(i){var e;try{const s=await H(i);this.userProfile=s;try{this.currentUser=await W(),this.isOwner=((e=this.currentUser)==null?void 0:e._id)===s._id}catch(u){console.warn("Not logged in or failed to fetch current user:",u),this.currentUser=null,this.isOwner=!1}this.editForm.name=s.name||`${s.firstName} ${s.lastName}`,this.editForm.bio=s.bio,console.log("Fetching projects for:",i),this.userProjects=await J(i),console.log("User Projects:",this.userProjects)}catch(s){console.error("Error loading profile or projects:",s)}},async handleProfileUpdate(){var i,e;this.errorMessage="",this.loading=!0;try{let s=this.editForm.avatar;if(s&&typeof s=="object"){const t=new FormData;t.append("image",s),s=(await _.post("/api/upload/image/profile",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const u={name:this.editForm.name,bio:this.editForm.bio,avatar:s};await _.patch("/api/users",u,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.fetchProfileAndProjects(this.$route.params.username),this.showEditProfile=!1}catch(s){this.errorMessage=((e=(i=s.response)==null?void 0:i.data)==null?void 0:e.message)||s.message||"Failed to update profile. Please try again."}finally{this.loading=!1}},async saveProject(){this.loading=!0;try{let i=this.projectForm.coverImage;if(i&&typeof i=="object"){const u=new FormData;u.append("image",i),i=(await _.post("/api/upload/image/blog",u,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={title:this.projectForm.title,description:this.projectForm.description,content:this.projectForm.content,coverImage:i,tags:this.projectForm.tags,githubUrl:this.projectForm.githubUrl,type:this.projectForm.type};let s;if(this.projectForm._id){s=await _.patch(`/api/posts/${this.projectForm._id}`,e,{headers:{Authorization:`Bearer ${this.accessToken}`}});const u=s.data.post,t=this.userProjects.findIndex(m=>m._id===u._id);t!==-1&&this.userProjects.splice(t,1,u)}else s=await _.post("/api/posts",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects.push(s.data.post);this.showNewProject=!1,this.resetProjectForm()}catch(i){console.error("Project save failed:",i)}finally{this.loading=!1}},editProject(i){this.projectForm={...i},this.showNewProject=!0},async deleteProject(i){if(confirm("Are you sure you want to delete this project?")){this.loading=!0;try{await _.delete(`/api/posts/${i._id}`,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects=this.userProjects.filter(e=>e._id!==i._id)}catch(e){console.error("Project deletion failed:",e)}finally{this.loading=!1}}},resetProjectForm(){this.projectForm={title:"",description:"",image:null,tags:[],githubUrl:"",type:""}}},mounted(){const i=this.$route.params.username;this.fetchProfileAndProjects(i)}},X={class:"text-h4 mb-2"},Y={class:"text-subtitle-1 mb-2"},Z={class:"text-body-1"};function $(i,e,s,u,t,m){const x=n("v-img"),v=n("v-card-text"),c=n("v-btn"),P=n("v-card-actions"),h=n("v-card"),F=n("v-col"),V=n("v-toolbar-title"),j=n("v-spacer"),k=n("v-toolbar"),z=n("v-card-title"),M=n("v-chip"),C=n("v-row"),O=n("v-container"),b=n("v-text-field"),N=n("v-file-input"),T=n("v-form"),A=n("v-dialog"),B=n("v-textarea"),S=n("v-combobox"),R=n("v-select"),q=n("v-icon"),L=n("v-alert");return d(),U("div",null,[o(O,null,{default:r(()=>[o(C,{class:"mb-6"},{default:r(()=>[o(F,{cols:"12",md:"4"},{default:r(()=>[o(h,null,{default:r(()=>[o(x,{src:t.userProfile.avatar,height:"300",cover:""},null,8,["src"]),o(v,null,{default:r(()=>[w("h2",X,f(t.userProfile.firstName+" "+t.userProfile.lastName),1),w("p",Y,f(t.userProfile.email),1),w("p",Z,f(t.userProfile.bio),1)]),_:1}),o(P,null,{default:r(()=>[t.isOwner?(d(),p(c,{key:0,color:"primary",variant:"outlined",onClick:e[0]||(e[0]=l=>t.showEditProfile=!0)},{default:r(()=>e[14]||(e[14]=[a(" Edit Profile ")])),_:1,__:[14]})):g("",!0)]),_:1})]),_:1})]),_:1}),o(F,{cols:"12",md:"20"},{default:r(()=>[o(h,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[15]||(e[15]=[a("My Projects")])),_:1,__:[15]}),o(j),t.isOwner?(d(),p(c,{key:0,color:"white",variant:"text",onClick:e[1]||(e[1]=l=>t.showNewProject=!0)},{default:r(()=>e[16]||(e[16]=[a(" Add New Project ")])),_:1,__:[16]})):g("",!0)]),_:1}),o(v,null,{default:r(()=>[o(C,null,{default:r(()=>[(d(!0),U(E,null,D(t.userProjects,l=>(d(),p(F,{key:l._id,cols:"12",md:"6"},{default:r(()=>[o(h,null,{default:r(()=>[o(x,{src:l.coverImage,height:"200",cover:""},null,8,["src"]),o(z,null,{default:r(()=>[a(f(l.title),1)]),_:2},1024),o(v,null,{default:r(()=>[w("p",null,f(l.description),1),(d(!0),U(E,null,D(l.tags,y=>(d(),p(M,{key:y,class:"mr-2 mb-2",size:"small"},{default:r(()=>[a(f(y),1)]),_:2},1024))),128))]),_:2},1024),o(P,null,{default:r(()=>[o(c,{color:"primary",variant:"text",to:`/${t.userProfile.username}/${l.id}`},{default:r(()=>e[17]||(e[17]=[a(" View ")])),_:2,__:[17]},1032,["to"]),t.isOwner?(d(),p(c,{key:0,color:"primary",variant:"text",onClick:y=>m.editProject(l)},{default:r(()=>e[18]||(e[18]=[a(" Edit ")])),_:2,__:[18]},1032,["onClick"])):g("",!0),o(j),t.isOwner?(d(),p(c,{key:1,color:"error",variant:"text",onClick:y=>m.deleteProject(l)},{default:r(()=>e[19]||(e[19]=[a(" Delete ")])),_:2,__:[19]},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(A,{modelValue:t.showEditProfile,"onUpdate:modelValue":e[5]||(e[5]=l=>t.showEditProfile=l),"max-width":"500"},{default:r(()=>[o(h,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[20]||(e[20]=[a("Edit Profile")])),_:1,__:[20]})]),_:1}),o(v,null,{default:r(()=>[o(T,{onSubmit:I(i.saveProfile,["prevent"])},{default:r(()=>[o(b,{modelValue:t.editForm.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.editForm.name=l),label:"Name",required:""},null,8,["modelValue"]),o(b,{modelValue:t.editForm.bio,"onUpdate:modelValue":e[3]||(e[3]=l=>t.editForm.bio=l),label:"Bio",multiline:"",rows:"3"},null,8,["modelValue"]),o(N,{modelValue:t.editForm.avatar,"onUpdate:modelValue":e[4]||(e[4]=l=>t.editForm.avatar=l),label:"Profile Picture",accept:"image/*","prepend-icon":"mdi-camera"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(P,null,{default:r(()=>[o(j),o(c,{color:"primary",onClick:i.saveProfile,loading:t.loading},{default:r(()=>e[21]||(e[21]=[a(" Save Changes ")])),_:1,__:[21]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(A,{modelValue:t.showNewProject,"onUpdate:modelValue":e[13]||(e[13]=l=>t.showNewProject=l),"max-width":"800"},{default:r(()=>[o(h,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(V,null,{default:r(()=>e[22]||(e[22]=[a("Add New Project")])),_:1,__:[22]})]),_:1}),o(v,null,{default:r(()=>[o(T,{onSubmit:I(m.saveProject,["prevent"])},{default:r(()=>[o(b,{modelValue:t.projectForm.title,"onUpdate:modelValue":e[6]||(e[6]=l=>t.projectForm.title=l),label:"Project Title",required:""},null,8,["modelValue"]),o(B,{modelValue:t.projectForm.description,"onUpdate:modelValue":e[7]||(e[7]=l=>t.projectForm.description=l),label:"Project Description",required:""},null,8,["modelValue"]),o(B,{modelValue:t.projectForm.content,"onUpdate:modelValue":e[8]||(e[8]=l=>t.projectForm.content=l),label:"Project Content",required:""},null,8,["modelValue"]),o(N,{modelValue:t.projectForm.coverImage,"onUpdate:modelValue":e[9]||(e[9]=l=>t.projectForm.coverImage=l),label:"Project Cover Image",accept:"image/*","prepend-icon":"mdi-image"},null,8,["modelValue"]),o(S,{modelValue:t.projectForm.tags,"onUpdate:modelValue":e[10]||(e[10]=l=>t.projectForm.tags=l),label:"Tags",multiple:"",chips:"","small-chips":""},null,8,["modelValue"]),o(b,{modelValue:t.projectForm.githubUrl,"onUpdate:modelValue":e[11]||(e[11]=l=>t.projectForm.githubUrl=l),label:"GitHub Repository URL","prepend-icon":"mdi-github"},null,8,["modelValue"]),o(R,{modelValue:t.projectForm.type,"onUpdate:modelValue":e[12]||(e[12]=l=>t.projectForm.type=l),items:t.projectTypes,label:"Project Type",required:""},null,8,["modelValue","items"])]),_:1},8,["onSubmit"])]),_:1}),o(P,null,{default:r(()=>[o(j),o(c,{color:"primary",onClick:m.saveProject,loading:t.loading},{default:r(()=>e[23]||(e[23]=[a(" Save Project ")])),_:1,__:[23]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.errorMessage?(d(),p(L,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:r(()=>[o(q,{color:"error",size:"24"},{default:r(()=>e[24]||(e[24]=[a("mdi-alert-circle")])),_:1,__:[24]})]),default:r(()=>[a(" "+f(t.errorMessage),1)]),_:1})):g("",!0)])}const oe=G(Q,[["render",$]]);export{oe as default};
