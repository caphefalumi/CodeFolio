import{_ as q,c as D,o as p,a as o,f as v,g as B,w as e,h as z,r as i,b as n,t as d,d as a,F as L,i as M,k as J,j as K,p as g,e as b}from"./index-DvCLckIm.js";const O={name:"ProjectDetailView",data(){return{project:{title:"",description:"",image:"",author:"",tags:[],githubUrl:"",createdAt:"",updatedAt:"",views:0,upvotes:0,downvotes:0,upvoting:!1,downvoting:!1},githubStats:{stars:0,forks:0,issues:0},comments:[],newComment:"",errorMessage:"",showAuthBanner:!1,authBannerTimeout:null,loading:!1}},methods:{async fetchProjectDetail(){try{const{username:r,id:t}=this.$route.params;let u={};const f=g&&g();f&&(u.Authorization=`Bearer ${f}`);const l=(await b.get(`/api/posts/${r}/${t}`,{headers:u})).data;this.project={title:l.title,description:l.description,image:l.coverImage,author:l.author.username,tags:l.tags||[],githubUrl:l.githubUrl,createdAt:new Date(l.createdAt).toLocaleDateString(),updatedAt:new Date(l.updatedAt).toLocaleDateString(),views:l.views,upvotes:l.upvotes||0,downvotes:l.downvotes||0,upvoting:!1,downvoting:!1,liked:l.liked},this.comments=(l.comments||[]).map(h=>({id:h._id,author:h.user.username,date:new Date(h.createdAt).toLocaleDateString(),content:h.content})),this.project.githubUrl&&this.fetchGitHubStats()}catch(r){console.error("Error fetching project detail:",r)}},async fetchGitHubStats(){try{const r=this.project.githubUrl.replace("https://github.com/","https://api.github.com/repos/"),t=await b.get(r),{stargazers_count:u,forks_count:f,open_issues_count:s}=t.data;this.githubStats={stars:u,forks:f,issues:s}}catch(r){console.error("Error fetching GitHub stats:",r)}},toggleLike(){this.project.liked=!this.project.liked},async addComment(){var r,t;this.errorMessage="",this.loading=!0;try{if(!this.newComment.trim())return;const u=g(),f=await b.post(`/api/posts/${this.$route.params.id}/comments`,{content:this.newComment},{headers:{Authorization:`Bearer ${u}`}});this.comments.unshift({id:`c${Date.now()}`,author:"You",date:new Date().toLocaleDateString(),content:this.newComment}),this.newComment=""}catch(u){this.errorMessage=((t=(r=u.response)==null?void 0:r.data)==null?void 0:t.message)||u.message||"Failed to post comment. Please try again."}finally{this.loading=!1}},async upvoteProject(){if(!this.project.upvoting){this.project.upvoting=!0;try{const r=g(),t=await b.post(`/api/posts/${this.$route.params.id}/upvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=t.data.upvotes,this.project.downvotes=t.data.downvotes,this.project.liked=t.data.liked}catch(r){this.handleVoteError(r)}finally{this.project.upvoting=!1}}},async downvoteProject(){if(!this.project.downvoting){this.project.downvoting=!0;try{const r=g(),t=await b.post(`/api/posts/${this.$route.params.id}/downvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=t.data.upvotes,this.project.downvotes=t.data.downvotes,this.project.liked=t.data.liked}catch(r){this.handleVoteError(r)}finally{this.project.downvoting=!1}}},handleVoteError(r){var t,u;r.response&&r.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((u=(t=r.response)==null?void 0:t.data)==null?void 0:u.message)||r.message||"Failed to vote."}},mounted(){this.fetchProjectDetail()}},Q={class:"text-body-1 mb-4"},R={class:"text-h5 font-weight-bold mx-2",style:{"min-width":"32px","text-align":"center"},"aria-live":"polite"},W={"aria-labelledby":"github-stats-heading"},X={class:"text-center"},Z={class:"text-h4"},$={class:"text-center"},tt={class:"text-h4"},et={class:"text-center"},ot={class:"text-h4"},st={"aria-labelledby":"project-details-heading"},rt={"aria-labelledby":"comments-heading"};function nt(r,t,u,f,s,l){const h=i("v-img"),w=i("v-card-title"),T=i("v-card-subtitle"),E=i("v-chip"),j=i("v-card-text"),_=i("v-icon"),y=i("v-btn"),G=i("v-spacer"),H=i("v-card-actions"),k=i("v-card"),m=i("v-col"),S=i("v-row"),x=i("v-list-item-title"),A=i("v-list-item-subtitle"),C=i("v-list-item"),V=i("v-list"),P=i("v-alert"),F=i("v-textarea"),N=i("v-form"),I=i("v-avatar"),Y=i("v-container"),U=K("auto-animate");return p(),D("div",null,[o(Y,null,{default:e(()=>[z((p(),v(S,null,{default:e(()=>[o(m,{cols:"12"},{default:e(()=>[n("article",null,[o(k,null,{default:e(()=>[o(h,{src:s.project.image,height:"400",cover:"",alt:`${s.project.title} project cover image`},null,8,["src","alt"]),o(w,{class:"text-h3"},{default:e(()=>[n("h1",null,d(s.project.title),1)]),_:1}),o(T,null,{default:e(()=>[t[1]||(t[1]=a("By ")),n("span",null,d(s.project.author),1)]),_:1,__:[1]}),o(j,null,{default:e(()=>[n("p",Q,d(s.project.description),1),n("div",null,[(p(!0),D(L,null,M(s.project.tags,c=>(p(),v(E,{key:c,class:"mr-2 mb-2"},{default:e(()=>[a(d(c),1)]),_:2},1024))),128))])]),_:1}),o(H,{class:"justify-center align-center"},{default:e(()=>[o(y,{icon:"",onClick:l.upvoteProject,disabled:s.project.upvoting,class:"mr-2","aria-label":`Upvote project. Current score: ${s.project.upvotes-s.project.downvotes}`},{default:e(()=>[o(_,{color:s.project.liked===!0?"success":"grey","aria-hidden":"true"},{default:e(()=>t[2]||(t[2]=[a("mdi-arrow-up-bold")])),_:1,__:[2]},8,["color"])]),_:1},8,["onClick","disabled","aria-label"]),n("div",R,d(s.project.upvotes-s.project.downvotes),1),o(y,{icon:"",onClick:l.downvoteProject,disabled:s.project.downvoting,class:"ml-2","aria-label":`Downvote project. Current score: ${s.project.upvotes-s.project.downvotes}`},{default:e(()=>[o(_,{color:s.project.liked===!1?"error":"grey","aria-hidden":"true"},{default:e(()=>t[3]||(t[3]=[a("mdi-arrow-down-bold")])),_:1,__:[3]},8,["color"])]),_:1},8,["onClick","disabled","aria-label"]),o(G),o(y,{color:"primary",variant:"text",href:s.project.githubUrl,target:"_blank","prepend-icon":"mdi-github",rel:"noopener noreferrer","aria-label":"View project on GitHub (opens in new tab)"},{default:e(()=>t[4]||(t[4]=[a(" View on GitHub ")])),_:1,__:[4]},8,["href"])]),_:1})]),_:1})])]),_:1}),s.project.githubUrl?(p(),v(m,{key:0,cols:"12",md:"6"},{default:e(()=>[n("section",W,[o(k,null,{default:e(()=>[o(w,null,{default:e(()=>t[5]||(t[5]=[n("h2",{id:"github-stats-heading"},"GitHub Stats",-1)])),_:1,__:[5]}),o(j,null,{default:e(()=>[o(S,null,{default:e(()=>[o(m,{cols:"4"},{default:e(()=>[n("div",X,[n("div",Z,d(s.githubStats.stars),1),t[6]||(t[6]=n("div",{class:"text-subtitle-1"},"Stars",-1))])]),_:1}),o(m,{cols:"4"},{default:e(()=>[n("div",$,[n("div",tt,d(s.githubStats.forks),1),t[7]||(t[7]=n("div",{class:"text-subtitle-1"},"Forks",-1))])]),_:1}),o(m,{cols:"4"},{default:e(()=>[n("div",et,[n("div",ot,d(s.githubStats.issues),1),t[8]||(t[8]=n("div",{class:"text-subtitle-1"},"Issues",-1))])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})):B("",!0),o(m,{cols:"12",md:"6"},{default:e(()=>[n("section",st,[o(k,null,{default:e(()=>[o(w,null,{default:e(()=>t[9]||(t[9]=[n("h2",{id:"project-details-heading"},"Project Details",-1)])),_:1,__:[9]}),o(j,null,{default:e(()=>[o(V,null,{default:e(()=>[o(C,null,{prepend:e(()=>[o(_,{"aria-hidden":"true"},{default:e(()=>t[10]||(t[10]=[a("mdi-calendar")])),_:1,__:[10]})]),default:e(()=>[o(x,null,{default:e(()=>t[11]||(t[11]=[a("Created")])),_:1,__:[11]}),o(A,null,{default:e(()=>[a(d(s.project.createdAt),1)]),_:1})]),_:1}),o(C,null,{prepend:e(()=>[o(_,{"aria-hidden":"true"},{default:e(()=>t[12]||(t[12]=[a("mdi-update")])),_:1,__:[12]})]),default:e(()=>[o(x,null,{default:e(()=>t[13]||(t[13]=[a("Last Updated")])),_:1,__:[13]}),o(A,null,{default:e(()=>[a(d(s.project.updatedAt),1)]),_:1})]),_:1}),o(C,null,{prepend:e(()=>[o(_,{"aria-hidden":"true"},{default:e(()=>t[14]||(t[14]=[a("mdi-eye")])),_:1,__:[14]})]),default:e(()=>[o(x,null,{default:e(()=>t[15]||(t[15]=[a("Views")])),_:1,__:[15]}),o(A,null,{default:e(()=>[a(d(s.project.views),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),o(m,{cols:"12"},{default:e(()=>[n("section",rt,[o(k,null,{default:e(()=>[o(w,null,{default:e(()=>t[16]||(t[16]=[n("h2",{id:"comments-heading"},"Comments",-1)])),_:1,__:[16]}),o(j,null,{default:e(()=>[s.errorMessage?(p(),v(P,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"},role:"alert","aria-live":"polite"},{prepend:e(()=>[o(_,{color:"error",size:"24","aria-hidden":"true"},{default:e(()=>t[17]||(t[17]=[a("mdi-alert-circle")])),_:1,__:[17]})]),default:e(()=>[a(" "+d(s.errorMessage),1)]),_:1})):B("",!0),o(N,{onSubmit:J(l.addComment,["prevent"])},{default:e(()=>[o(F,{modelValue:s.newComment,"onUpdate:modelValue":t[0]||(t[0]=c=>s.newComment=c),label:"Add a comment",rows:"3",variant:"outlined"},null,8,["modelValue"]),o(y,{color:"primary",type:"submit",disabled:!s.newComment.trim()},{default:e(()=>t[18]||(t[18]=[a("Post Comment")])),_:1,__:[18]},8,["disabled"])]),_:1},8,["onSubmit"])]),_:1}),z((p(),v(V,{"aria-label":"Project comments"},{default:e(()=>[(p(!0),D(L,null,M(s.comments,c=>(p(),v(C,{key:c.id,subtitle:c.author+" â€¢ "+c.date,role:"article","aria-label":`Comment by ${c.author} on ${c.date}`},{prepend:e(()=>[o(I,{color:"primary","aria-label":`${c.author} avatar`},{default:e(()=>[a(d(c.author.charAt(0)),1)]),_:2},1032,["aria-label"])]),default:e(()=>[o(x,null,{default:e(()=>[a(d(c.content),1)]),_:2},1024)]),_:2},1032,["subtitle","aria-label"]))),128))]),_:1})),[[U]])]),_:1})])]),_:1})]),_:1})),[[U]])]),_:1}),s.showAuthBanner?(p(),v(P,{key:0,type:"warning",class:"mb-4 fade-banner auth-banner-fixed text-center",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fffbe7",color:"#b26a00","font-weight":"500",transition:"opacity 1s","z-index":"9999"}},{prepend:e(()=>[o(_,{color:"warning",size:"24"},{default:e(()=>t[19]||(t[19]=[a("mdi-alert")])),_:1,__:[19]})]),default:e(()=>[t[20]||(t[20]=n("div",{class:"banner-center"},"You must be logged in to vote on projects.",-1))]),_:1,__:[20]})):B("",!0)])}const at=q(O,[["render",nt],["__scopeId","data-v-773c5126"]]);export{at as default};
