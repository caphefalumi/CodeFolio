import{_ as Y,c as D,o as p,a as o,g as f,i as B,w as e,h as z,r as l,d as n,t as a,b as d,F as L,e as T,j as q,p as g,f as b}from"./index-DauhjLGg.js";const J={name:"ProjectDetailView",data(){return{project:{title:"",description:"",image:"",author:"",tags:[],githubUrl:"",createdAt:"",updatedAt:"",views:0,upvotes:0,downvotes:0,upvoting:!1,downvoting:!1},githubStats:{stars:0,forks:0,issues:0},comments:[],newComment:"",errorMessage:"",showAuthBanner:!1,authBannerTimeout:null,loading:!1}},methods:{async fetchProjectDetail(){try{const{username:r,id:t}=this.$route.params;let u={};const v=g&&g();v&&(u.Authorization=`Bearer ${v}`);const i=(await b.get(`/api/posts/${r}/${t}`,{headers:u})).data;this.project={title:i.title,description:i.description,image:i.coverImage,author:i.author.username,tags:i.tags||[],githubUrl:i.githubUrl,createdAt:new Date(i.createdAt).toLocaleDateString(),updatedAt:new Date(i.updatedAt).toLocaleDateString(),views:i.views,upvotes:i.upvotes||0,downvotes:i.downvotes||0,upvoting:!1,downvoting:!1,liked:i.liked},this.comments=(i.comments||[]).map(h=>({id:h._id,author:h.user.username,date:new Date(h.createdAt).toLocaleDateString(),content:h.content})),this.project.githubUrl&&this.fetchGitHubStats()}catch(r){console.error("Error fetching project detail:",r)}},async fetchGitHubStats(){try{const r=this.project.githubUrl.replace("https://github.com/","https://api.github.com/repos/"),t=await b.get(r),{stargazers_count:u,forks_count:v,open_issues_count:s}=t.data;this.githubStats={stars:u,forks:v,issues:s}}catch(r){console.error("Error fetching GitHub stats:",r)}},toggleLike(){this.project.liked=!this.project.liked},async addComment(){var r,t;this.errorMessage="",this.loading=!0;try{if(!this.newComment.trim())return;const u=g(),v=await b.post(`/api/posts/${this.$route.params.id}/comments`,{content:this.newComment},{headers:{Authorization:`Bearer ${u}`}});this.comments.unshift({id:`c${Date.now()}`,author:"You",date:new Date().toLocaleDateString(),content:this.newComment}),this.newComment=""}catch(u){this.errorMessage=((t=(r=u.response)==null?void 0:r.data)==null?void 0:t.message)||u.message||"Failed to post comment. Please try again."}finally{this.loading=!1}},async upvoteProject(){if(!this.project.upvoting){this.project.upvoting=!0;try{const r=g(),t=await b.post(`/api/posts/${this.$route.params.id}/upvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=t.data.upvotes,this.project.downvotes=t.data.downvotes,this.project.liked=t.data.liked}catch(r){this.handleVoteError(r)}finally{this.project.upvoting=!1}}},async downvoteProject(){if(!this.project.downvoting){this.project.downvoting=!0;try{const r=g(),t=await b.post(`/api/posts/${this.$route.params.id}/downvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=t.data.upvotes,this.project.downvotes=t.data.downvotes,this.project.liked=t.data.liked}catch(r){this.handleVoteError(r)}finally{this.project.downvoting=!1}}},handleVoteError(r){var t,u;r.response&&r.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((u=(t=r.response)==null?void 0:t.data)==null?void 0:u.message)||r.message||"Failed to vote."}},mounted(){this.fetchProjectDetail()}},K={class:"text-body-1 mb-4"},O={class:"text-h5 font-weight-bold mx-2",style:{"min-width":"32px","text-align":"center"}},Q={class:"text-center"},R={class:"text-h4"},W={class:"text-center"},X={class:"text-h4"},Z={class:"text-center"},$={class:"text-h4"};function tt(r,t,u,v,s,i){const h=l("v-img"),w=l("v-card-title"),E=l("v-card-subtitle"),M=l("v-chip"),j=l("v-card-text"),_=l("v-icon"),k=l("v-btn"),F=l("v-spacer"),G=l("v-card-actions"),y=l("v-card"),m=l("v-col"),S=l("v-row"),x=l("v-list-item-title"),A=l("v-list-item-subtitle"),C=l("v-list-item"),V=l("v-list"),P=l("v-alert"),H=l("v-textarea"),N=l("v-avatar"),I=l("v-container"),U=q("auto-animate");return p(),D("div",null,[o(I,null,{default:e(()=>[z((p(),f(S,null,{default:e(()=>[o(m,{cols:"12"},{default:e(()=>[o(y,null,{default:e(()=>[o(h,{src:s.project.image,height:"400",cover:""},null,8,["src"]),o(w,{class:"text-h3"},{default:e(()=>[n(a(s.project.title),1)]),_:1}),o(E,null,{default:e(()=>[n(" By "+a(s.project.author),1)]),_:1}),o(j,null,{default:e(()=>[d("p",K,a(s.project.description),1),(p(!0),D(L,null,T(s.project.tags,c=>(p(),f(M,{key:c,class:"mr-2 mb-2"},{default:e(()=>[n(a(c),1)]),_:2},1024))),128))]),_:1}),o(G,{class:"justify-center align-center"},{default:e(()=>[o(k,{icon:"",onClick:i.upvoteProject,disabled:s.project.upvoting,class:"mr-2"},{default:e(()=>[o(_,{color:s.project.liked===!0?"success":"grey"},{default:e(()=>t[1]||(t[1]=[n("mdi-arrow-up-bold")])),_:1,__:[1]},8,["color"])]),_:1},8,["onClick","disabled"]),d("div",O,a(s.project.upvotes-s.project.downvotes),1),o(k,{icon:"",onClick:i.downvoteProject,disabled:s.project.downvoting,class:"ml-2"},{default:e(()=>[o(_,{color:s.project.liked===!1?"error":"grey"},{default:e(()=>t[2]||(t[2]=[n("mdi-arrow-down-bold")])),_:1,__:[2]},8,["color"])]),_:1},8,["onClick","disabled"]),o(F),o(k,{color:"primary",variant:"text",href:s.project.githubUrl,target:"_blank","prepend-icon":"mdi-github"},{default:e(()=>t[3]||(t[3]=[n(" View on GitHub ")])),_:1,__:[3]},8,["href"])]),_:1})]),_:1})]),_:1}),s.project.githubUrl?(p(),f(m,{key:0,cols:"12",md:"6"},{default:e(()=>[o(y,null,{default:e(()=>[o(w,null,{default:e(()=>t[4]||(t[4]=[n("GitHub Stats")])),_:1,__:[4]}),o(j,null,{default:e(()=>[o(S,null,{default:e(()=>[o(m,{cols:"4"},{default:e(()=>[d("div",Q,[d("div",R,a(s.githubStats.stars),1),t[5]||(t[5]=d("div",{class:"text-subtitle-1"},"Stars",-1))])]),_:1}),o(m,{cols:"4"},{default:e(()=>[d("div",W,[d("div",X,a(s.githubStats.forks),1),t[6]||(t[6]=d("div",{class:"text-subtitle-1"},"Forks",-1))])]),_:1}),o(m,{cols:"4"},{default:e(()=>[d("div",Z,[d("div",$,a(s.githubStats.issues),1),t[7]||(t[7]=d("div",{class:"text-subtitle-1"},"Issues",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):B("",!0),o(m,{cols:"12",md:"6"},{default:e(()=>[o(y,null,{default:e(()=>[o(w,null,{default:e(()=>t[8]||(t[8]=[n("Project Details")])),_:1,__:[8]}),o(j,null,{default:e(()=>[o(V,null,{default:e(()=>[o(C,null,{prepend:e(()=>[o(_,null,{default:e(()=>t[9]||(t[9]=[n("mdi-calendar")])),_:1,__:[9]})]),default:e(()=>[o(x,null,{default:e(()=>t[10]||(t[10]=[n("Created")])),_:1,__:[10]}),o(A,null,{default:e(()=>[n(a(s.project.createdAt),1)]),_:1})]),_:1}),o(C,null,{prepend:e(()=>[o(_,null,{default:e(()=>t[11]||(t[11]=[n("mdi-update")])),_:1,__:[11]})]),default:e(()=>[o(x,null,{default:e(()=>t[12]||(t[12]=[n("Last Updated")])),_:1,__:[12]}),o(A,null,{default:e(()=>[n(a(s.project.updatedAt),1)]),_:1})]),_:1}),o(C,null,{prepend:e(()=>[o(_,null,{default:e(()=>t[13]||(t[13]=[n("mdi-eye")])),_:1,__:[13]})]),default:e(()=>[o(x,null,{default:e(()=>t[14]||(t[14]=[n("Views")])),_:1,__:[14]}),o(A,null,{default:e(()=>[n(a(s.project.views),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{cols:"12"},{default:e(()=>[o(y,null,{default:e(()=>[o(w,null,{default:e(()=>t[15]||(t[15]=[n("Comments")])),_:1,__:[15]}),o(j,null,{default:e(()=>[s.errorMessage?(p(),f(P,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:e(()=>[o(_,{color:"error",size:"24"},{default:e(()=>t[16]||(t[16]=[n("mdi-alert-circle")])),_:1,__:[16]})]),default:e(()=>[n(" "+a(s.errorMessage),1)]),_:1})):B("",!0),o(H,{modelValue:s.newComment,"onUpdate:modelValue":t[0]||(t[0]=c=>s.newComment=c),label:"Add a comment",rows:"3",variant:"outlined"},null,8,["modelValue"]),o(k,{color:"primary",onClick:i.addComment,disabled:!s.newComment.trim()},{default:e(()=>t[17]||(t[17]=[n(" Post Comment ")])),_:1,__:[17]},8,["onClick","disabled"])]),_:1}),z((p(),f(V,null,{default:e(()=>[(p(!0),D(L,null,T(s.comments,c=>(p(),f(C,{key:c.id,subtitle:c.author+" â€¢ "+c.date},{prepend:e(()=>[o(N,{color:"primary"},{default:e(()=>[n(a(c.author.charAt(0)),1)]),_:2},1024)]),default:e(()=>[o(x,null,{default:e(()=>[n(a(c.content),1)]),_:2},1024)]),_:2},1032,["subtitle"]))),128))]),_:1})),[[U]])]),_:1})]),_:1})]),_:1})),[[U]])]),_:1}),s.showAuthBanner?(p(),f(P,{key:0,type:"warning",class:"mb-4 fade-banner auth-banner-fixed text-center",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fffbe7",color:"#b26a00","font-weight":"500",transition:"opacity 1s","z-index":"9999"}},{prepend:e(()=>[o(_,{color:"warning",size:"24"},{default:e(()=>t[18]||(t[18]=[n("mdi-alert")])),_:1,__:[18]})]),default:e(()=>[t[19]||(t[19]=d("div",{class:"banner-center"},"You must be logged in to vote on projects.",-1))]),_:1,__:[19]})):B("",!0)])}const ot=Y(J,[["render",tt],["__scopeId","data-v-4729682b"]]);export{ot as default};
