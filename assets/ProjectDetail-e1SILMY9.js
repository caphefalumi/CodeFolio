import{_ as Y,c as C,o as _,a as o,g as f,i as A,w as t,h as U,r as l,d as n,t as u,b as d,F as V,e as z,j as q,p as B,f as v}from"./index-DSPybLn8.js";const J={name:"ProjectDetailView",data(){return{project:{title:"",description:"",image:"",author:"",tags:[],githubUrl:"",createdAt:"",updatedAt:"",views:0,upvotes:0,downvotes:0,upvoting:!1,downvoting:!1},githubStats:{stars:0,forks:0,issues:0},comments:[],newComment:"",errorMessage:"",showAuthBanner:!1,authBannerTimeout:null,loading:!1}},methods:{async fetchProjectDetail(){try{const{username:i,id:e}=this.$route.params,a=(await v.get(`/api/posts/${i}/${e}`)).data;this.project={title:a.title,description:a.description,image:a.coverImage,author:a.author.username,tags:a.tags||[],githubUrl:a.githubUrl,createdAt:new Date(a.createdAt).toLocaleDateString(),updatedAt:new Date(a.updatedAt).toLocaleDateString(),views:a.views,upvotes:a.upvotes||0,downvotes:a.downvotes||0,upvoting:!1,downvoting:!1},this.comments=(a.comments||[]).map(s=>({id:s._id,author:s.user.username,date:new Date(s.createdAt).toLocaleDateString(),content:s.content})),this.project.githubUrl&&this.fetchGitHubStats()}catch(i){console.error("Error fetching project detail:",i)}},async fetchGitHubStats(){try{const i=this.project.githubUrl.replace("https://github.com/","https://api.github.com/repos/"),e=await v.get(i),{stargazers_count:r,forks_count:a,open_issues_count:s}=e.data;this.githubStats={stars:r,forks:a,issues:s}}catch(i){console.error("Error fetching GitHub stats:",i)}},toggleLike(){this.project.liked=!this.project.liked},async addComment(){var i,e;this.errorMessage="",this.loading=!0;try{if(!this.newComment.trim())return;const r=B(),a=await v.post(`/api/posts/${this.$route.params.id}/comments`,{content:this.newComment},{headers:{Authorization:`Bearer ${r}`}});this.comments.unshift({id:`c${Date.now()}`,author:"You",date:new Date().toLocaleDateString(),content:this.newComment}),this.newComment=""}catch(r){this.errorMessage=((e=(i=r.response)==null?void 0:i.data)==null?void 0:e.message)||r.message||"Failed to post comment. Please try again."}finally{this.loading=!1}},async upvoteProject(){var i,e;this.project.upvoting=!0;try{const r=B(),a=await v.post(`/api/posts/${this.$route.params.id}/upvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=a.data.upvotes,this.project.downvotes=a.data.downvotes}catch(r){r.response&&r.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((e=(i=r.response)==null?void 0:i.data)==null?void 0:e.message)||r.message||"Failed to upvote."}finally{this.project.upvoting=!1}},async downvoteProject(){var i,e;this.project.downvoting=!0;try{const r=B(),a=await v.post(`/api/posts/${this.$route.params.id}/downvote`,{},{headers:{Authorization:`Bearer ${r}`}});this.project.upvotes=a.data.upvotes,this.project.downvotes=a.data.downvotes}catch(r){r.response&&r.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((e=(i=r.response)==null?void 0:i.data)==null?void 0:e.message)||r.message||"Failed to downvote."}finally{this.project.downvoting=!1}}},mounted(){this.fetchProjectDetail()}},K={class:"text-body-1 mb-4"},O={class:"mx-2"},Q={class:"text-center"},R={class:"text-h4"},W={class:"text-center"},X={class:"text-h4"},Z={class:"text-center"},$={class:"text-h4"};function tt(i,e,r,a,s,k){const L=l("v-img"),h=l("v-card-title"),M=l("v-card-subtitle"),F=l("v-chip"),g=l("v-card-text"),b=l("v-btn"),G=l("v-spacer"),p=l("v-icon"),H=l("v-card-actions"),w=l("v-card"),m=l("v-col"),D=l("v-row"),j=l("v-list-item-title"),x=l("v-list-item-subtitle"),y=l("v-list-item"),S=l("v-list"),P=l("v-alert"),N=l("v-textarea"),E=l("v-avatar"),I=l("v-container"),T=q("auto-animate");return _(),C("div",null,[o(I,null,{default:t(()=>[U((_(),f(D,null,{default:t(()=>[o(m,{cols:"12"},{default:t(()=>[o(w,null,{default:t(()=>[o(L,{src:s.project.image,height:"400",cover:""},null,8,["src"]),o(h,{class:"text-h3"},{default:t(()=>[n(u(s.project.title),1)]),_:1}),o(M,null,{default:t(()=>[n(" By "+u(s.project.author),1)]),_:1}),o(g,null,{default:t(()=>[d("p",K,u(s.project.description),1),(_(!0),C(V,null,z(s.project.tags,c=>(_(),f(F,{key:c,class:"mr-2 mb-2"},{default:t(()=>[n(u(c),1)]),_:2},1024))),128))]),_:1}),o(H,null,{default:t(()=>[o(b,{color:"primary",variant:"text",href:s.project.githubUrl,target:"_blank","prepend-icon":"mdi-github"},{default:t(()=>e[1]||(e[1]=[n(" View on GitHub ")])),_:1,__:[1]},8,["href"]),o(G),o(b,{icon:"",onClick:k.upvoteProject,disabled:s.project.upvoting},{default:t(()=>[o(p,{color:"success"},{default:t(()=>e[2]||(e[2]=[n("mdi-arrow-up-bold")])),_:1,__:[2]})]),_:1},8,["onClick","disabled"]),d("span",O,u(s.project.upvotes-s.project.downvotes),1),o(b,{icon:"",onClick:k.downvoteProject,disabled:s.project.downvoting},{default:t(()=>[o(p,{color:"error"},{default:t(()=>e[3]||(e[3]=[n("mdi-arrow-down-bold")])),_:1,__:[3]})]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1}),s.project.githubUrl?(_(),f(m,{key:0,cols:"12",md:"6"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[4]||(e[4]=[n("GitHub Stats")])),_:1,__:[4]}),o(g,null,{default:t(()=>[o(D,null,{default:t(()=>[o(m,{cols:"4"},{default:t(()=>[d("div",Q,[d("div",R,u(s.githubStats.stars),1),e[5]||(e[5]=d("div",{class:"text-subtitle-1"},"Stars",-1))])]),_:1}),o(m,{cols:"4"},{default:t(()=>[d("div",W,[d("div",X,u(s.githubStats.forks),1),e[6]||(e[6]=d("div",{class:"text-subtitle-1"},"Forks",-1))])]),_:1}),o(m,{cols:"4"},{default:t(()=>[d("div",Z,[d("div",$,u(s.githubStats.issues),1),e[7]||(e[7]=d("div",{class:"text-subtitle-1"},"Issues",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):A("",!0),o(m,{cols:"12",md:"6"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[8]||(e[8]=[n("Project Details")])),_:1,__:[8]}),o(g,null,{default:t(()=>[o(S,null,{default:t(()=>[o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[9]||(e[9]=[n("mdi-calendar")])),_:1,__:[9]})]),default:t(()=>[o(j,null,{default:t(()=>e[10]||(e[10]=[n("Created")])),_:1,__:[10]}),o(x,null,{default:t(()=>[n(u(s.project.createdAt),1)]),_:1})]),_:1}),o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[11]||(e[11]=[n("mdi-update")])),_:1,__:[11]})]),default:t(()=>[o(j,null,{default:t(()=>e[12]||(e[12]=[n("Last Updated")])),_:1,__:[12]}),o(x,null,{default:t(()=>[n(u(s.project.updatedAt),1)]),_:1})]),_:1}),o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[13]||(e[13]=[n("mdi-eye")])),_:1,__:[13]})]),default:t(()=>[o(j,null,{default:t(()=>e[14]||(e[14]=[n("Views")])),_:1,__:[14]}),o(x,null,{default:t(()=>[n(u(s.project.views),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{cols:"12"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[15]||(e[15]=[n("Comments")])),_:1,__:[15]}),o(g,null,{default:t(()=>[s.errorMessage?(_(),f(P,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:t(()=>[o(p,{color:"error",size:"24"},{default:t(()=>e[16]||(e[16]=[n("mdi-alert-circle")])),_:1,__:[16]})]),default:t(()=>[n(" "+u(s.errorMessage),1)]),_:1})):A("",!0),o(N,{modelValue:s.newComment,"onUpdate:modelValue":e[0]||(e[0]=c=>s.newComment=c),label:"Add a comment",rows:"3",variant:"outlined"},null,8,["modelValue"]),o(b,{color:"primary",onClick:k.addComment,disabled:!s.newComment.trim()},{default:t(()=>e[17]||(e[17]=[n(" Post Comment ")])),_:1,__:[17]},8,["onClick","disabled"])]),_:1}),U((_(),f(S,null,{default:t(()=>[(_(!0),C(V,null,z(s.comments,c=>(_(),f(y,{key:c.id,subtitle:c.author+" â€¢ "+c.date},{prepend:t(()=>[o(E,{color:"primary"},{default:t(()=>[n(u(c.author.charAt(0)),1)]),_:2},1024)]),default:t(()=>[o(j,null,{default:t(()=>[n(u(c.content),1)]),_:2},1024)]),_:2},1032,["subtitle"]))),128))]),_:1})),[[T]])]),_:1})]),_:1})]),_:1})),[[T]])]),_:1}),s.showAuthBanner?(_(),f(P,{key:0,type:"warning",class:"mb-4 fade-banner auth-banner-fixed text-center",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fffbe7",color:"#b26a00","font-weight":"500",transition:"opacity 1s","z-index":"9999"}},{prepend:t(()=>[o(p,{color:"warning",size:"24"},{default:t(()=>e[18]||(e[18]=[n("mdi-alert")])),_:1,__:[18]})]),default:t(()=>[e[19]||(e[19]=d("div",{class:"banner-center"},"You must be logged in to vote on projects.",-1))]),_:1,__:[19]})):A("",!0)])}const ot=Y(J,[["render",tt],["__scopeId","data-v-f59aa177"]]);export{ot as default};
