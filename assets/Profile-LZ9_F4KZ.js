import{_ as q,c as x,o as d,a as t,w as r,r as s,b,t as p,g as f,h as F,d as a,F as E,e as I,i as z,f as _,j as L,k as M,l as G,m as H}from"./index-CeU_B2Cf.js";const J={name:"ProfileView",data(){return{userProfile:{},userProjects:[],showEditProfile:!1,showNewProject:!1,loading:!1,isOwner:!1,editForm:{name:"",bio:"",avatar:null},projectForm:{title:"",description:"",content:"",coverImage:null,tags:[],githubUrl:""}}},computed:{accessToken(){return H()}},methods:{async fetchProfileAndProjects(i){var e;try{const n=await L(i);this.userProfile=n;try{this.currentUser=await M(),this.isOwner=((e=this.currentUser)==null?void 0:e._id)===n._id}catch(u){console.warn("Not logged in or failed to fetch current user:",u),this.currentUser=null,this.isOwner=!1}this.editForm.name=n.name||`${n.firstName} ${n.lastName}`,this.editForm.bio=n.bio,console.log("Fetching projects for:",i),this.userProjects=await G(i),console.log("User Projects:",this.userProjects)}catch(n){console.error("Error loading profile or projects:",n)}},async saveProfile(){this.loading=!0;try{let i=this.editForm.avatar;if(i&&typeof i=="object"){const n=new FormData;n.append("image",i),i=(await _.post("/api/upload/image/profile",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={name:this.editForm.name,bio:this.editForm.bio,avatar:i};await _.patch("/api/users",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.fetchProfileAndProjects(this.$route.params.username),this.showEditProfile=!1}catch(i){console.error("Profile update failed:",i)}finally{this.loading=!1}},async saveProject(){this.loading=!0;try{let i=this.projectForm.coverImage;if(i&&typeof i=="object"){const u=new FormData;u.append("image",i),i=(await _.post("/api/upload/image/blog",u,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={title:this.projectForm.title,description:this.projectForm.description,content:this.projectForm.content,coverImage:i,tags:this.projectForm.tags,githubUrl:this.projectForm.githubUrl};let n;if(this.projectForm._id){n=await _.patch(`/api/posts/${this.projectForm._id}`,e,{headers:{Authorization:`Bearer ${this.accessToken}`}});const u=n.data.post,o=this.userProjects.findIndex(m=>m._id===u._id);o!==-1&&this.userProjects.splice(o,1,u)}else n=await _.post("/api/posts",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects.push(n.data.post);this.showNewProject=!1,this.resetProjectForm()}catch(i){console.error("Project save failed:",i)}finally{this.loading=!1}},editProject(i){this.projectForm={...i},this.showNewProject=!0},async deleteProject(i){if(confirm("Are you sure you want to delete this project?")){this.loading=!0;try{await _.delete(`/api/posts/${i._id}`,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects=this.userProjects.filter(e=>e._id!==i._id)}catch(e){console.error("Project deletion failed:",e)}finally{this.loading=!1}}},resetProjectForm(){this.projectForm={title:"",description:"",image:null,tags:[],githubUrl:""}}},mounted(){const i=this.$route.params.username;this.fetchProfileAndProjects(i)}},K={class:"text-h4 mb-2"},Q={class:"text-subtitle-1 mb-2"},W={class:"text-body-1"};function X(i,e,n,u,o,m){const U=s("v-img"),v=s("v-card-text"),c=s("v-btn"),P=s("v-card-actions"),h=s("v-card"),V=s("v-col"),y=s("v-toolbar-title"),g=s("v-spacer"),k=s("v-toolbar"),D=s("v-card-title"),O=s("v-chip"),C=s("v-row"),S=s("v-container"),j=s("v-text-field"),N=s("v-file-input"),A=s("v-form"),T=s("v-dialog"),B=s("v-textarea"),R=s("v-combobox");return d(),x("div",null,[t(S,null,{default:r(()=>[t(C,{class:"mb-6"},{default:r(()=>[t(V,{cols:"12",md:"4"},{default:r(()=>[t(h,null,{default:r(()=>[t(U,{src:o.userProfile.avatar,height:"300",cover:""},null,8,["src"]),t(v,null,{default:r(()=>[b("h2",K,p(o.userProfile.firstName+" "+o.userProfile.lastName),1),b("p",Q,p(o.userProfile.email),1),b("p",W,p(o.userProfile.bio),1)]),_:1}),t(P,null,{default:r(()=>[o.isOwner?(d(),f(c,{key:0,color:"primary",variant:"outlined",onClick:e[0]||(e[0]=l=>o.showEditProfile=!0)},{default:r(()=>e[13]||(e[13]=[a(" Edit Profile ")])),_:1,__:[13]})):F("",!0)]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"20"},{default:r(()=>[t(h,null,{default:r(()=>[t(k,{color:"primary",dark:"",flat:""},{default:r(()=>[t(y,null,{default:r(()=>e[14]||(e[14]=[a("My Projects")])),_:1,__:[14]}),t(g),o.isOwner?(d(),f(c,{key:0,color:"white",variant:"text",onClick:e[1]||(e[1]=l=>o.showNewProject=!0)},{default:r(()=>e[15]||(e[15]=[a(" Add New Project ")])),_:1,__:[15]})):F("",!0)]),_:1}),t(v,null,{default:r(()=>[t(C,null,{default:r(()=>[(d(!0),x(E,null,I(o.userProjects,l=>(d(),f(V,{key:l._id,cols:"12",md:"6"},{default:r(()=>[t(h,null,{default:r(()=>[t(U,{src:l.coverImage,height:"200",cover:""},null,8,["src"]),t(D,null,{default:r(()=>[a(p(l.title),1)]),_:2},1024),t(v,null,{default:r(()=>[b("p",null,p(l.description),1),(d(!0),x(E,null,I(l.tags,w=>(d(),f(O,{key:w,class:"mr-2 mb-2",size:"small"},{default:r(()=>[a(p(w),1)]),_:2},1024))),128))]),_:2},1024),t(P,null,{default:r(()=>[t(c,{color:"primary",variant:"text",to:`/${o.userProfile.username}/${l.id}`},{default:r(()=>e[16]||(e[16]=[a(" View ")])),_:2,__:[16]},1032,["to"]),o.isOwner?(d(),f(c,{key:0,color:"primary",variant:"text",onClick:w=>m.editProject(l)},{default:r(()=>e[17]||(e[17]=[a(" Edit ")])),_:2,__:[17]},1032,["onClick"])):F("",!0),t(g),o.isOwner?(d(),f(c,{key:1,color:"error",variant:"text",onClick:w=>m.deleteProject(l)},{default:r(()=>e[18]||(e[18]=[a(" Delete ")])),_:2,__:[18]},1032,["onClick"])):F("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(T,{modelValue:o.showEditProfile,"onUpdate:modelValue":e[5]||(e[5]=l=>o.showEditProfile=l),"max-width":"500"},{default:r(()=>[t(h,null,{default:r(()=>[t(k,{color:"primary",dark:"",flat:""},{default:r(()=>[t(y,null,{default:r(()=>e[19]||(e[19]=[a("Edit Profile")])),_:1,__:[19]})]),_:1}),t(v,null,{default:r(()=>[t(A,{onSubmit:z(m.saveProfile,["prevent"])},{default:r(()=>[t(j,{modelValue:o.editForm.name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.editForm.name=l),label:"Name",required:""},null,8,["modelValue"]),t(j,{modelValue:o.editForm.bio,"onUpdate:modelValue":e[3]||(e[3]=l=>o.editForm.bio=l),label:"Bio",multiline:"",rows:"3"},null,8,["modelValue"]),t(N,{modelValue:o.editForm.avatar,"onUpdate:modelValue":e[4]||(e[4]=l=>o.editForm.avatar=l),label:"Profile Picture",accept:"image/*","prepend-icon":"mdi-camera"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(P,null,{default:r(()=>[t(g),t(c,{color:"primary",onClick:m.saveProfile,loading:o.loading},{default:r(()=>e[20]||(e[20]=[a(" Save Changes ")])),_:1,__:[20]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:o.showNewProject,"onUpdate:modelValue":e[12]||(e[12]=l=>o.showNewProject=l),"max-width":"800"},{default:r(()=>[t(h,null,{default:r(()=>[t(k,{color:"primary",dark:"",flat:""},{default:r(()=>[t(y,null,{default:r(()=>e[21]||(e[21]=[a("Add New Project")])),_:1,__:[21]})]),_:1}),t(v,null,{default:r(()=>[t(A,{onSubmit:z(m.saveProject,["prevent"])},{default:r(()=>[t(j,{modelValue:o.projectForm.title,"onUpdate:modelValue":e[6]||(e[6]=l=>o.projectForm.title=l),label:"Project Title",required:""},null,8,["modelValue"]),t(B,{modelValue:o.projectForm.description,"onUpdate:modelValue":e[7]||(e[7]=l=>o.projectForm.description=l),label:"Project Description",required:""},null,8,["modelValue"]),t(B,{modelValue:o.projectForm.content,"onUpdate:modelValue":e[8]||(e[8]=l=>o.projectForm.content=l),label:"Project Content",required:""},null,8,["modelValue"]),t(N,{modelValue:o.projectForm.coverImage,"onUpdate:modelValue":e[9]||(e[9]=l=>o.projectForm.coverImage=l),label:"Project Cover Image",accept:"image/*","prepend-icon":"mdi-image"},null,8,["modelValue"]),t(R,{modelValue:o.projectForm.tags,"onUpdate:modelValue":e[10]||(e[10]=l=>o.projectForm.tags=l),label:"Tags",multiple:"",chips:"","small-chips":""},null,8,["modelValue"]),t(j,{modelValue:o.projectForm.githubUrl,"onUpdate:modelValue":e[11]||(e[11]=l=>o.projectForm.githubUrl=l),label:"GitHub Repository URL","prepend-icon":"mdi-github"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(P,null,{default:r(()=>[t(g),t(c,{color:"primary",onClick:m.saveProject,loading:o.loading},{default:r(()=>e[22]||(e[22]=[a(" Save Project ")])),_:1,__:[22]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Z=q(J,[["render",X]]);export{Z as default};
