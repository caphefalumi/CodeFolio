import{_ as J,c as B,o as c,a as o,f as _,g as A,w as t,h as U,r as i,b as r,t as d,F as E,i as L,d as a,j as K,v as w,e as y}from"./index-e39HvZBY.js";import{A as O,u as Q}from"./common-FDs1CWLr.js";import{A as R}from"./AppForm-YyapBM-J.js";const W={name:"ProjectDetailView",components:{AppAlert:O,AppForm:R},setup(){const{handleError:n}=Q();return{handleError:n}},data(){return{project:{title:"",description:"",content:"",image:"",author:"",tags:[],githubUrl:"",createdAt:"",updatedAt:"",views:0,upvotes:0,downvotes:0,upvoting:!1,downvoting:!1},githubStats:{stars:0,forks:0,issues:0},comments:[],newComment:"",errorMessage:"",showAuthBanner:!1,authBannerTimeout:null,loading:!1}},methods:{async fetchProjectDetail(){try{const{username:n,id:e}=this.$route.params;let v={};const f=w&&w();f&&(v.Authorization=`Bearer ${f}`);const l=(await y.get(`/api/posts/${n}/${e}`,{headers:v})).data;this.project={title:l.title,description:l.description,content:l.content,image:l.coverImage,author:l.author.username,tags:l.tags||[],githubUrl:l.githubUrl,createdAt:new Date(l.createdAt).toLocaleDateString(),updatedAt:new Date(l.updatedAt).toLocaleDateString(),views:l.views,upvotes:l.upvotes||0,downvotes:l.downvotes||0,upvoting:!1,downvoting:!1,liked:l.liked},this.comments=(l.comments||[]).map(m=>({id:m._id,author:m.user.username,date:new Date(m.createdAt).toLocaleDateString(),content:m.content})),this.project.githubUrl&&this.fetchGitHubStats()}catch(n){console.error("Error fetching project detail:",n)}},async fetchGitHubStats(){try{const n=this.project.githubUrl.replace("https://github.com/","https://api.github.com/repos/"),e=await y.get(n),{stargazers_count:v,forks_count:f,open_issues_count:s}=e.data;this.githubStats={stars:v,forks:f,issues:s}}catch(n){console.error("Error fetching GitHub stats:",n)}},toggleLike(){this.project.liked=!this.project.liked},async addComment(){this.errorMessage="",this.loading=!0;try{if(!this.newComment.trim())return;const n=w(),e=await y.post(`/api/posts/${this.$route.params.id}/comments`,{content:this.newComment},{headers:{Authorization:`Bearer ${n}`}});this.comments.unshift({id:`c${Date.now()}`,author:"You",date:new Date().toLocaleDateString(),content:this.newComment}),this.newComment=""}catch(n){this.errorMessage=this.handleError(n,"Failed to post comment. Please try again.")}finally{this.loading=!1}},async upvoteProject(){if(!this.project.upvoting){this.project.upvoting=!0;try{const n=w(),e=await y.post(`/api/posts/${this.$route.params.id}/upvote`,{},{headers:{Authorization:`Bearer ${n}`}});this.project.upvotes=e.data.upvotes,this.project.downvotes=e.data.downvotes,this.project.liked=e.data.liked}catch(n){this.handleVoteError(n)}finally{this.project.upvoting=!1}}},async downvoteProject(){if(!this.project.downvoting){this.project.downvoting=!0;try{const n=w(),e=await y.post(`/api/posts/${this.$route.params.id}/downvote`,{},{headers:{Authorization:`Bearer ${n}`}});this.project.upvotes=e.data.upvotes,this.project.downvotes=e.data.downvotes,this.project.liked=e.data.liked}catch(n){this.handleVoteError(n)}finally{this.project.downvoting=!1}}},handleVoteError(n){n.response&&n.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=this.handleError(n,"Failed to vote.")}},mounted(){this.fetchProjectDetail()}},X={class:"text-body-1 mb-4"},Z={class:"text-h5 font-weight-bold mx-2",style:{"min-width":"32px","text-align":"center"},"aria-live":"polite"},$={"aria-labelledby":"project-content-heading"},tt=["innerHTML"],et={"aria-labelledby":"github-stats-heading"},ot={class:"text-center"},st={class:"text-h4"},nt={class:"text-center"},rt={class:"text-h4"},it={class:"text-center"},lt={class:"text-h4"},at={"aria-labelledby":"project-details-heading"},ut={"aria-labelledby":"comments-heading"};function dt(n,e,v,f,s,l){const m=i("v-img"),b=i("v-card-title"),T=i("v-card-subtitle"),H=i("v-chip"),g=i("v-card-text"),h=i("v-icon"),C=i("v-btn"),M=i("v-spacer"),z=i("v-card-actions"),j=i("v-card"),p=i("v-col"),S=i("v-row"),k=i("v-list-item-title"),D=i("v-list-item-subtitle"),x=i("v-list-item"),V=i("v-list"),F=i("app-alert"),G=i("v-textarea"),N=i("app-form"),I=i("v-avatar"),Y=i("v-container"),q=i("v-alert"),P=K("auto-animate");return c(),B("div",null,[o(Y,null,{default:t(()=>[U((c(),_(S,null,{default:t(()=>[o(p,{cols:"12"},{default:t(()=>[r("article",null,[o(j,null,{default:t(()=>[o(m,{src:s.project.image,height:"400",cover:"",alt:`${s.project.title} project cover image`},null,8,["src","alt"]),o(b,{class:"text-h3"},{default:t(()=>[r("h1",null,d(s.project.title),1)]),_:1}),o(T,null,{default:t(()=>[r("span",null,"By "+d(s.project.author),1)]),_:1}),o(g,null,{default:t(()=>[r("p",X,d(s.project.description),1),r("div",null,[(c(!0),B(E,null,L(s.project.tags,u=>(c(),_(H,{key:u,class:"mr-2 mb-2"},{default:t(()=>[a(d(u),1)]),_:2},1024))),128))])]),_:1}),o(z,{class:"justify-center align-center"},{default:t(()=>[o(C,{icon:"",onClick:l.upvoteProject,disabled:s.project.upvoting,class:"mr-2","aria-label":`Upvote project. Current score: ${s.project.upvotes-s.project.downvotes}`},{default:t(()=>[o(h,{color:s.project.liked===!0?"success":"grey","aria-hidden":"true"},{default:t(()=>e[1]||(e[1]=[a("mdi-arrow-up-bold")])),_:1,__:[1]},8,["color"])]),_:1},8,["onClick","disabled","aria-label"]),r("div",Z,d(s.project.upvotes-s.project.downvotes),1),o(C,{icon:"",onClick:l.downvoteProject,disabled:s.project.downvoting,class:"ml-2","aria-label":`Downvote project. Current score: ${s.project.upvotes-s.project.downvotes}`},{default:t(()=>[o(h,{color:s.project.liked===!1?"error":"grey","aria-hidden":"true"},{default:t(()=>e[2]||(e[2]=[a("mdi-arrow-down-bold")])),_:1,__:[2]},8,["color"])]),_:1},8,["onClick","disabled","aria-label"]),o(M),o(C,{color:"primary",variant:"text",href:s.project.githubUrl,target:"_blank","prepend-icon":"mdi-github",rel:"noopener noreferrer","aria-label":"View project on GitHub (opens in new tab)"},{default:t(()=>e[3]||(e[3]=[a(" View on GitHub ")])),_:1,__:[3]},8,["href"])]),_:1})]),_:1})])]),_:1}),s.project.content?(c(),_(p,{key:0,cols:"12"},{default:t(()=>[r("section",$,[o(j,null,{default:t(()=>[o(b,null,{default:t(()=>e[4]||(e[4]=[r("h2",{id:"project-content-heading"}," Project Content ",-1)])),_:1,__:[4]}),o(g,null,{default:t(()=>[r("div",{class:"project-content",innerHTML:s.project.content},null,8,tt)]),_:1})]),_:1})])]),_:1})):A("",!0),s.project.githubUrl?(c(),_(p,{key:1,cols:"12",md:"6"},{default:t(()=>[r("section",et,[o(j,null,{default:t(()=>[o(b,null,{default:t(()=>e[5]||(e[5]=[r("h2",{id:"github-stats-heading"},"GitHub Stats",-1)])),_:1,__:[5]}),o(g,null,{default:t(()=>[o(S,null,{default:t(()=>[o(p,{cols:"4"},{default:t(()=>[r("div",ot,[r("div",st,d(s.githubStats.stars),1),e[6]||(e[6]=r("div",{class:"text-subtitle-1"},"Stars",-1))])]),_:1}),o(p,{cols:"4"},{default:t(()=>[r("div",nt,[r("div",rt,d(s.githubStats.forks),1),e[7]||(e[7]=r("div",{class:"text-subtitle-1"},"Forks",-1))])]),_:1}),o(p,{cols:"4"},{default:t(()=>[r("div",it,[r("div",lt,d(s.githubStats.issues),1),e[8]||(e[8]=r("div",{class:"text-subtitle-1"},"Issues",-1))])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})):A("",!0),o(p,{cols:"12",md:"6"},{default:t(()=>[r("section",at,[o(j,null,{default:t(()=>[o(b,null,{default:t(()=>e[9]||(e[9]=[r("h2",{id:"project-details-heading"}," Project Details ",-1)])),_:1,__:[9]}),o(g,null,{default:t(()=>[o(V,null,{default:t(()=>[o(x,null,{prepend:t(()=>[o(h,{"aria-hidden":"true"},{default:t(()=>e[10]||(e[10]=[a("mdi-calendar")])),_:1,__:[10]})]),default:t(()=>[o(k,null,{default:t(()=>e[11]||(e[11]=[a("Created")])),_:1,__:[11]}),o(D,null,{default:t(()=>[a(d(s.project.createdAt),1)]),_:1})]),_:1}),o(x,null,{prepend:t(()=>[o(h,{"aria-hidden":"true"},{default:t(()=>e[12]||(e[12]=[a("mdi-update")])),_:1,__:[12]})]),default:t(()=>[o(k,null,{default:t(()=>e[13]||(e[13]=[a("Last Updated")])),_:1,__:[13]}),o(D,null,{default:t(()=>[a(d(s.project.updatedAt),1)]),_:1})]),_:1}),o(x,null,{prepend:t(()=>[o(h,{"aria-hidden":"true"},{default:t(()=>e[14]||(e[14]=[a("mdi-eye")])),_:1,__:[14]})]),default:t(()=>[o(k,null,{default:t(()=>e[15]||(e[15]=[a("Views")])),_:1,__:[15]}),o(D,null,{default:t(()=>[a(d(s.project.views),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),o(p,{cols:"12"},{default:t(()=>[r("section",ut,[o(j,null,{default:t(()=>[o(b,null,{default:t(()=>e[16]||(e[16]=[r("h2",{id:"comments-heading"},"Comments",-1)])),_:1,__:[16]}),o(g,null,{default:t(()=>[s.errorMessage?(c(),_(F,{key:0,type:"error",message:s.errorMessage,"custom-class":"mb-4"},null,8,["message"])):A("",!0),o(N,{loading:s.loading,"submit-button-text":"Post Comment","submit-button-disabled":!s.newComment.trim(),onSubmit:l.addComment},{default:t(()=>[o(G,{modelValue:s.newComment,"onUpdate:modelValue":e[0]||(e[0]=u=>s.newComment=u),label:"Add a comment",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["loading","submit-button-disabled","onSubmit"])]),_:1}),U((c(),_(V,{"aria-label":"Project comments"},{default:t(()=>[(c(!0),B(E,null,L(s.comments,u=>(c(),_(x,{key:u.id,subtitle:u.author+" â€¢ "+u.date,role:"article","aria-label":`Comment by ${u.author} on ${u.date}`},{prepend:t(()=>[o(I,{color:"primary","aria-label":`${u.author} avatar`},{default:t(()=>[a(d(u.author.charAt(0)),1)]),_:2},1032,["aria-label"])]),default:t(()=>[o(k,null,{default:t(()=>[a(d(u.content),1)]),_:2},1024)]),_:2},1032,["subtitle","aria-label"]))),128))]),_:1})),[[P]])]),_:1})])]),_:1})]),_:1})),[[P]])]),_:1}),s.showAuthBanner?(c(),_(q,{key:0,type:"warning",class:"mb-4 fade-banner auth-banner-fixed text-center",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fffbe7",color:"#b26a00","font-weight":"500",transition:"opacity 1s","z-index":"9999"}},{prepend:t(()=>[o(h,{color:"warning",size:"24"},{default:t(()=>e[17]||(e[17]=[a("mdi-alert")])),_:1,__:[17]})]),default:t(()=>[e[18]||(e[18]=r("div",{class:"banner-center"}," You must be logged in to vote on projects. ",-1))]),_:1,__:[18]})):A("",!0)])}const mt=J(W,[["render",dt],["__scopeId","data-v-93b92240"]]);export{mt as default};
