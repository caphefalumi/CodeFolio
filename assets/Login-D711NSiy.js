import{_ as h,g as u,o as _,w as r,i as b,d as l,r as o,t as w,C as N,a as t,b as d,k as S,f as v}from"./index-8Zv1DPTr.js";const B={name:"VIconLogin",props:{provider:{type:String,required:!0}},computed:{providerName(){return this.provider}}};function P(s,e,n,a,i,c){const m=o("v-icon"),g=o("v-btn");return _(),u(g,{class:"login-btn",block:"",elevation:"1"},{default:r(()=>[n.provider==="google"?(_(),u(m,{key:0,left:"",class:"me-2 google-icon",color:"#EA4335"})):n.provider==="github"?(_(),u(m,{key:1,left:"",class:"me-2 github-icon",color:"#4267B2"})):b("",!0),l(" Login with "+w(c.providerName),1)]),_:1})}const U=h(B,[["render",P],["__scopeId","data-v-41519d0b"]]),j={components:{GoogleLogin:N,vIconLogin:U},data(){return{loading:!1,errorMessage:"",form:{email:"",password:""},rules:{required:s=>!!s||"This field is required",email:s=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(s)||"Email must be valid"}}},mounted(){window.addEventListener("message",this.receiveGithubToken)},beforeUnmount(){window.removeEventListener("message",this.receiveGithubToken)},methods:{async handleLogin(){var s,e;this.errorMessage="",this.loading=!0;try{const n=await v.post("/api/auth/login/jwt",{email:this.form.email,password:this.form.password},{withCredentials:!0});sessionStorage.setItem("accessToken",n.data.accessToken),this.$router.push("/")}catch(n){this.errorMessage=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||n.message||"An unexpected error occurred. Please try again."}finally{this.loading=!1}},async handleGoogleLogin(s){var e,n;this.errorMessage="",this.loading=!0;try{const a=await v.post("/api/auth/login/google",{token:s.access_token});sessionStorage.setItem("accessToken",a.data.accessToken),window.location.href="/"}catch(a){this.errorMessage=((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.message)||a.message||"Google login failed. Please try again"}finally{this.loading=!1}},handleGithubLogin(){this.errorMessage="",window.open("/api/auth/login/github","GitHub Login","width=500,height=600")},receiveGithubToken(s){if(s.origin!=="http://localhost:3001")return;const{accessToken:e,error:n}=s.data||{};e?(sessionStorage.setItem("accessToken",e),window.location.href="/"):n&&(this.errorMessage=n)}}},A={class:"login-buttons"},D={class:"login-btn-wrapper"},O={class:"text-center mt-4"};function z(s,e,n,a,i,c){const m=o("v-card-title"),g=o("v-text-field"),k=o("v-icon"),y=o("v-alert"),x=o("v-btn"),L=o("v-form"),G=o("v-divider"),f=o("v-icon-login"),T=o("GoogleLogin"),V=o("router-link"),M=o("v-card-text"),q=o("v-card"),C=o("v-col"),E=o("v-row"),I=o("v-container");return _(),u(I,null,{default:r(()=>[t(E,{justify:"center"},{default:r(()=>[t(C,{cols:"12",sm:"8",md:"6"},{default:r(()=>[t(q,{class:"mt-8"},{default:r(()=>[t(m,{class:"text-h4 text-center pt-6"},{default:r(()=>e[2]||(e[2]=[l(" Login ")])),_:1,__:[2]}),t(M,null,{default:r(()=>[t(L,{onSubmit:S(c.handleLogin,["prevent"])},{default:r(()=>[t(g,{modelValue:i.form.email,"onUpdate:modelValue":e[0]||(e[0]=p=>i.form.email=p),label:"Email",type:"email",required:"",rules:[i.rules.required,i.rules.email]},null,8,["modelValue","rules"]),t(g,{modelValue:i.form.password,"onUpdate:modelValue":e[1]||(e[1]=p=>i.form.password=p),label:"Password",type:"password",required:"",rules:[i.rules.required]},null,8,["modelValue","rules"]),i.errorMessage?(_(),u(y,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:r(()=>[t(k,{color:"error",size:"24"},{default:r(()=>e[3]||(e[3]=[l("mdi-alert-circle")])),_:1,__:[3]})]),default:r(()=>[l(" "+w(i.errorMessage),1)]),_:1})):b("",!0),t(x,{type:"submit",color:"primary",block:"",class:"mt-4",loading:i.loading},{default:r(()=>e[4]||(e[4]=[l("Login")])),_:1,__:[4]},8,["loading"])]),_:1},8,["onSubmit"]),t(G,{class:"my-4"}),e[6]||(e[6]=d("div",{class:"text-center text-body-2 mb-2"},[d("span",null,"Or login with")],-1)),d("div",A,[t(T,{callback:c.handleGoogleLogin,"auto-login":"","popup-type":"TOKEN"},{default:r(()=>[t(f,{provider:"google"})]),_:1},8,["callback"]),d("div",D,[t(f,{provider:"github",onClick:c.handleGithubLogin},null,8,["onClick"])])]),d("div",O,[t(V,{to:"/register",class:"text-decoration-none"},{default:r(()=>e[5]||(e[5]=[l(" Don't have an account? Register ")])),_:1,__:[5]})])]),_:1,__:[6]})]),_:1})]),_:1})]),_:1})]),_:1})}const K=h(j,[["render",z],["__scopeId","data-v-6113b944"]]);export{K as default};
