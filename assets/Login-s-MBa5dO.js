import{_ as f,f as u,o as m,w as s,g as E,d as _,r as t,t as M,C as q,a as n,b as l,e as h}from"./index-CDKgNPhV.js";import{A as C}from"./AppForm-BihCM0se.js";import{u as I}from"./common-BV6yZd2B.js";const N={name:"VIconLogin",props:{provider:{type:String,required:!0}},computed:{providerName(){return this.provider}}};function S(o,e,i,v,r,a){const c=t("v-icon"),d=t("v-btn");return m(),u(d,{class:"login-btn",block:"",elevation:"1"},{default:s(()=>[i.provider==="google"?(m(),u(c,{key:0,left:"",class:"me-2 google-icon",color:"#EA4335"})):i.provider==="github"?(m(),u(c,{key:1,left:"",class:"me-2 github-icon",color:"#4267B2"})):E("",!0),_("Login with "+M(a.providerName),1)]),_:1})}const A=f(N,[["render",S],["__scopeId","data-v-71c015bd"]]),B={components:{GoogleLogin:q,vIconLogin:A,AppForm:C},setup(){const{handleError:o}=I();return{handleError:o}},data(){return{loading:!1,errorMessage:"",form:{email:"",password:""},rules:{required:o=>!!o||"This field is required",email:o=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(o)||"Email must be valid"}}},mounted(){window.addEventListener("message",this.receiveGithubToken)},beforeUnmount(){window.removeEventListener("message",this.receiveGithubToken)},methods:{async handleLogin(){this.errorMessage="",this.loading=!0;try{const o=await h.post("/api/auth/login/jwt",{email:this.form.email,password:this.form.password},{withCredentials:!0});sessionStorage.setItem("accessToken",o.data.accessToken),this.$router.push("/")}catch(o){this.errorMessage=this.handleError(o,"Login failed. Please try again.")}finally{this.loading=!1}},async handleGoogleLogin(o){this.errorMessage="",this.loading=!0;try{const e=await h.post("/api/auth/login/google",{token:o.access_token});sessionStorage.setItem("accessToken",e.data.accessToken),window.location.href="/"}catch(e){this.errorMessage=this.handleError(e,"Google login failed. Please try again.")}finally{this.loading=!1}},handleGithubLogin(){this.errorMessage="",window.open("/api/auth/login/github","GitHub Login","width=500,height=600")},receiveGithubToken(o){if(o.origin!=="http://localhost:3001")return;const{accessToken:e,error:i}=o.data||{};e?(sessionStorage.setItem("accessToken",e),window.location.href="/"):i&&(this.errorMessage=i)}}},P={class:"login-buttons"},U={class:"login-btn-wrapper"},j={class:"text-center mt-4"};function D(o,e,i,v,r,a){const c=t("v-card-title"),d=t("v-text-field"),b=t("app-form"),w=t("v-divider"),p=t("v-icon-login"),k=t("GoogleLogin"),y=t("router-link"),L=t("v-card-text"),x=t("v-card"),G=t("v-col"),T=t("v-row"),V=t("v-container");return m(),u(V,null,{default:s(()=>[n(T,{justify:"center"},{default:s(()=>[n(G,{cols:"12",sm:"8",md:"6"},{default:s(()=>[n(x,{class:"mt-8"},{default:s(()=>[n(c,{class:"text-h4 text-center pt-6",id:"login-heading"},{default:s(()=>e[2]||(e[2]=[_("Login")])),_:1,__:[2]}),n(L,null,{default:s(()=>[n(b,{loading:r.loading,"error-message":r.errorMessage,"submit-button-text":"Login","submit-button-block":!0,"submit-button-class":"mt-4","aria-labelled-by":"login-heading",onSubmit:a.handleLogin},{default:s(()=>[n(d,{modelValue:r.form.email,"onUpdate:modelValue":e[0]||(e[0]=g=>r.form.email=g),label:"Email",type:"email",required:"",rules:[r.rules.required,r.rules.email],autocomplete:"email"},null,8,["modelValue","rules"]),n(d,{modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=g=>r.form.password=g),label:"Password",type:"password",required:"",rules:[r.rules.required],autocomplete:"current-password"},null,8,["modelValue","rules"])]),_:1},8,["loading","error-message","onSubmit"]),n(w,{class:"my-4","aria-hidden":"true"}),e[4]||(e[4]=l("div",{class:"text-center text-body-2 mb-2"},[l("span",null,"Or login with")],-1)),l("div",P,[n(k,{callback:a.handleGoogleLogin,"auto-login":"","popup-type":"TOKEN"},{default:s(()=>[n(p,{provider:"google"})]),_:1},8,["callback"]),l("div",U,[n(p,{provider:"github",onClick:a.handleGithubLogin},null,8,["onClick"])])]),l("div",j,[n(y,{to:"/register",class:"text-decoration-none"},{default:s(()=>e[3]||(e[3]=[_(" Don't have an account? Register ")])),_:1,__:[3]})])]),_:1,__:[4]})]),_:1})]),_:1})]),_:1})]),_:1})}const K=f(B,[["render",D],["__scopeId","data-v-7d2c4b3f"]]);export{K as default};
