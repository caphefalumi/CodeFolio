import{_ as N,c as C,o as _,a as o,g as f,h as A,w as t,r as l,d as r,t as u,b as d,F as P,e as T,f as v,m as E}from"./index-7GEEXJjE.js";const I={name:"ProjectDetailView",data(){return{project:{title:"",description:"",image:"",author:"",tags:[],githubUrl:"",createdAt:"",updatedAt:"",views:0,upvotes:0,downvotes:0,upvoting:!1,downvoting:!1},githubStats:{stars:0,forks:0,issues:0},comments:[],newComment:"",errorMessage:"",showAuthBanner:!1,authBannerTimeout:null,loading:!1}},methods:{async fetchProjectDetail(){try{const{username:a,id:e}=this.$route.params,i=(await v.get(`/api/posts/${a}/${e}`)).data;this.project={title:i.title,description:i.description,image:i.coverImage,author:i.author.username,tags:i.tags||[],githubUrl:i.githubUrl,createdAt:new Date(i.createdAt).toLocaleDateString(),updatedAt:new Date(i.updatedAt).toLocaleDateString(),views:i.views,upvotes:i.upvotes||0,downvotes:i.downvotes||0,upvoting:!1,downvoting:!1},this.comments=(i.comments||[]).map(s=>({id:s._id,author:s.user.username,date:new Date(s.createdAt).toLocaleDateString(),content:s.content})),this.project.githubUrl&&this.fetchGitHubStats()}catch(a){console.error("Error fetching project detail:",a)}},async fetchGitHubStats(){try{const a=this.project.githubUrl.replace("https://github.com/","https://api.github.com/repos/"),e=await v.get(a),{stargazers_count:n,forks_count:i,open_issues_count:s}=e.data;this.githubStats={stars:n,forks:i,issues:s}}catch(a){console.error("Error fetching GitHub stats:",a)}},toggleLike(){this.project.liked=!this.project.liked},async addComment(){var a,e;this.errorMessage="",this.loading=!0;try{if(!this.newComment.trim())return;const n=E(),i=await v.post(`/api/posts/${this.$route.params.id}/comments`,{content:this.newComment},{headers:{Authorization:`Bearer ${n}`}});this.comments.unshift({id:`c${Date.now()}`,author:"You",date:new Date().toLocaleDateString(),content:this.newComment}),this.newComment=""}catch(n){this.errorMessage=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||n.message||"Failed to post comment. Please try again."}finally{this.loading=!1}},async upvoteProject(){var a,e;this.project.upvoting=!0;try{const n=await v.post(`/api/posts/${this.$route.params.id}/upvote`);this.project.upvotes=n.data.upvotes,this.project.downvotes=n.data.downvotes}catch(n){n.response&&n.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||n.message||"Failed to upvote."}finally{this.project.upvoting=!1}},async downvoteProject(){var a,e;this.project.downvoting=!0;try{const n=await v.post(`/api/posts/${this.$route.params.id}/downvote`);this.project.upvotes=n.data.upvotes,this.project.downvotes=n.data.downvotes}catch(n){n.response&&n.response.status===401?(this.showAuthBanner=!0,clearTimeout(this.authBannerTimeout),this.authBannerTimeout=setTimeout(()=>{this.showAuthBanner=!1},5e3)):this.errorMessage=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||n.message||"Failed to downvote."}finally{this.project.downvoting=!1}}},mounted(){this.fetchProjectDetail()}},Y={class:"text-body-1 mb-4"},q={class:"mx-2"},J={class:"text-center"},K={class:"text-h4"},O={class:"text-center"},Q={class:"text-h4"},R={class:"text-center"},W={class:"text-h4"};function X(a,e,n,i,s,k){const U=l("v-img"),h=l("v-card-title"),V=l("v-card-subtitle"),L=l("v-chip"),g=l("v-card-text"),b=l("v-btn"),M=l("v-spacer"),p=l("v-icon"),F=l("v-card-actions"),w=l("v-card"),m=l("v-col"),B=l("v-row"),j=l("v-list-item-title"),x=l("v-list-item-subtitle"),y=l("v-list-item"),D=l("v-list"),S=l("v-alert"),z=l("v-textarea"),G=l("v-avatar"),H=l("v-container");return _(),C("div",null,[o(H,null,{default:t(()=>[o(B,null,{default:t(()=>[o(m,{cols:"12"},{default:t(()=>[o(w,null,{default:t(()=>[o(U,{src:s.project.image,height:"400",cover:""},null,8,["src"]),o(h,{class:"text-h3"},{default:t(()=>[r(u(s.project.title),1)]),_:1}),o(V,null,{default:t(()=>[r(" By "+u(s.project.author),1)]),_:1}),o(g,null,{default:t(()=>[d("p",Y,u(s.project.description),1),(_(!0),C(P,null,T(s.project.tags,c=>(_(),f(L,{key:c,class:"mr-2 mb-2"},{default:t(()=>[r(u(c),1)]),_:2},1024))),128))]),_:1}),o(F,null,{default:t(()=>[o(b,{color:"primary",variant:"text",href:s.project.githubUrl,target:"_blank","prepend-icon":"mdi-github"},{default:t(()=>e[1]||(e[1]=[r(" View on GitHub ")])),_:1,__:[1]},8,["href"]),o(M),o(b,{icon:"",onClick:k.upvoteProject,disabled:s.project.upvoting},{default:t(()=>[o(p,{color:"success"},{default:t(()=>e[2]||(e[2]=[r("mdi-arrow-up-bold")])),_:1,__:[2]})]),_:1},8,["onClick","disabled"]),d("span",q,u(s.project.upvotes-s.project.downvotes),1),o(b,{icon:"",onClick:k.downvoteProject,disabled:s.project.downvoting},{default:t(()=>[o(p,{color:"error"},{default:t(()=>e[3]||(e[3]=[r("mdi-arrow-down-bold")])),_:1,__:[3]})]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1}),s.project.githubUrl?(_(),f(m,{key:0,cols:"12",md:"6"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[4]||(e[4]=[r("GitHub Stats")])),_:1,__:[4]}),o(g,null,{default:t(()=>[o(B,null,{default:t(()=>[o(m,{cols:"4"},{default:t(()=>[d("div",J,[d("div",K,u(s.githubStats.stars),1),e[5]||(e[5]=d("div",{class:"text-subtitle-1"},"Stars",-1))])]),_:1}),o(m,{cols:"4"},{default:t(()=>[d("div",O,[d("div",Q,u(s.githubStats.forks),1),e[6]||(e[6]=d("div",{class:"text-subtitle-1"},"Forks",-1))])]),_:1}),o(m,{cols:"4"},{default:t(()=>[d("div",R,[d("div",W,u(s.githubStats.issues),1),e[7]||(e[7]=d("div",{class:"text-subtitle-1"},"Issues",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):A("",!0),o(m,{cols:"12",md:"6"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[8]||(e[8]=[r("Project Details")])),_:1,__:[8]}),o(g,null,{default:t(()=>[o(D,null,{default:t(()=>[o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[9]||(e[9]=[r("mdi-calendar")])),_:1,__:[9]})]),default:t(()=>[o(j,null,{default:t(()=>e[10]||(e[10]=[r("Created")])),_:1,__:[10]}),o(x,null,{default:t(()=>[r(u(s.project.createdAt),1)]),_:1})]),_:1}),o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[11]||(e[11]=[r("mdi-update")])),_:1,__:[11]})]),default:t(()=>[o(j,null,{default:t(()=>e[12]||(e[12]=[r("Last Updated")])),_:1,__:[12]}),o(x,null,{default:t(()=>[r(u(s.project.updatedAt),1)]),_:1})]),_:1}),o(y,null,{prepend:t(()=>[o(p,null,{default:t(()=>e[13]||(e[13]=[r("mdi-eye")])),_:1,__:[13]})]),default:t(()=>[o(j,null,{default:t(()=>e[14]||(e[14]=[r("Views")])),_:1,__:[14]}),o(x,null,{default:t(()=>[r(u(s.project.views),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{cols:"12"},{default:t(()=>[o(w,null,{default:t(()=>[o(h,null,{default:t(()=>e[15]||(e[15]=[r("Comments")])),_:1,__:[15]}),o(g,null,{default:t(()=>[s.errorMessage?(_(),f(S,{key:0,type:"error",class:"mb-4",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fff",color:"#d32f2f","font-weight":"500"}},{prepend:t(()=>[o(p,{color:"error",size:"24"},{default:t(()=>e[16]||(e[16]=[r("mdi-alert-circle")])),_:1,__:[16]})]),default:t(()=>[r(" "+u(s.errorMessage),1)]),_:1})):A("",!0),o(z,{modelValue:s.newComment,"onUpdate:modelValue":e[0]||(e[0]=c=>s.newComment=c),label:"Add a comment",rows:"3",variant:"outlined"},null,8,["modelValue"]),o(b,{color:"primary",onClick:k.addComment,disabled:!s.newComment.trim()},{default:t(()=>e[17]||(e[17]=[r(" Post Comment ")])),_:1,__:[17]},8,["onClick","disabled"])]),_:1}),o(D,null,{default:t(()=>[(_(!0),C(P,null,T(s.comments,c=>(_(),f(y,{key:c.id,subtitle:c.author+" â€¢ "+c.date},{prepend:t(()=>[o(G,{color:"primary"},{default:t(()=>[r(u(c.author.charAt(0)),1)]),_:2},1024)]),default:t(()=>[o(j,null,{default:t(()=>[r(u(c.content),1)]),_:2},1024)]),_:2},1032,["subtitle"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s.showAuthBanner?(_(),f(S,{key:0,type:"warning",class:"mb-4 fade-banner auth-banner-fixed text-center",border:"start","colored-border":"",elevation:"0",density:"comfortable",style:{"background-color":"#fffbe7",color:"#b26a00","font-weight":"500",transition:"opacity 1s","z-index":"9999"}},{prepend:t(()=>[o(p,{color:"warning",size:"24"},{default:t(()=>e[18]||(e[18]=[r("mdi-alert")])),_:1,__:[18]})]),default:t(()=>[e[19]||(e[19]=d("div",{class:"banner-center"},"You must be logged in to vote on projects.",-1))]),_:1,__:[19]})):A("",!0)])}const $=N(I,[["render",X],["__scopeId","data-v-9606ab3c"]]);export{$ as default};
