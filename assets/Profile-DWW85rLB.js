import{_ as q,c as x,o as u,a as o,w as r,r as s,b as w,t as p,g as f,h as F,d as n,F as E,e as I,i as z,f as _,j as L,k as M,l as G,m as H}from"./index-AEhTh6Un.js";const J={name:"ProfileView",data(){return{userProfile:{},userProjects:[],showEditProfile:!1,showNewProject:!1,loading:!1,isOwner:!1,currentUserId:"",editForm:{name:"",bio:"",avatar:null},projectForm:{title:"",description:"",content:"",coverImage:null,tags:[],githubUrl:""}}},computed:{accessToken(){return H()}},methods:{async fetchProfileAndProjects(i){try{const e=await L(i);this.userProfile=e;const a=await M();this.currentUserId=a._id,this.isOwner=e._id===a._id,this.editForm.name=e.name,this.editForm.bio=e.bio,this.userProjects=await G(i),console.log("User Projects:",this.userProjects)}catch(e){console.error("Error loading profile or projects:",e)}},async saveProfile(){this.loading=!0;try{let i=this.editForm.avatar;if(i&&typeof i=="object"){const a=new FormData;a.append("image",i),i=(await _.post("/api/upload/image/profile",a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={name:this.editForm.name,bio:this.editForm.bio,avatar:i};await _.patch("/api/users",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.fetchProfileAndProjects(this.$route.params.username),this.showEditProfile=!1}catch(i){console.error("Profile update failed:",i)}finally{this.loading=!1}},async saveProject(){this.loading=!0;try{let i=this.projectForm.coverImage;if(i&&typeof i=="object"){const m=new FormData;m.append("image",i),i=(await _.post("/api/upload/image/blog",m,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.accessToken}`}})).data.uri}const e={title:this.projectForm.title,description:this.projectForm.description,content:this.projectForm.content,coverImage:i,tags:this.projectForm.tags,githubUrl:this.projectForm.githubUrl};let a;if(this.projectForm._id){a=await _.patch(`/api/posts/${this.projectForm._id}`,e,{headers:{Authorization:`Bearer ${this.accessToken}`}});const m=a.data.post,t=this.userProjects.findIndex(d=>d._id===m._id);t!==-1&&this.userProjects.splice(t,1,m)}else a=await _.post("/api/posts",e,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects.push(a.data.post);this.showNewProject=!1,this.resetProjectForm()}catch(i){console.error("Project save failed:",i)}finally{this.loading=!1}},editProject(i){this.projectForm={...i},this.showNewProject=!0},async deleteProject(i){if(confirm("Are you sure you want to delete this project?")){this.loading=!0;try{await _.delete(`/api/posts/${i._id}`,{headers:{Authorization:`Bearer ${this.accessToken}`}}),this.userProjects=this.userProjects.filter(e=>e._id!==i._id)}catch(e){console.error("Project deletion failed:",e)}finally{this.loading=!1}}},resetProjectForm(){this.projectForm={title:"",description:"",image:null,tags:[],githubUrl:""}}},mounted(){const i=this.$route.params.username;this.fetchProfileAndProjects(i)}},K={class:"text-h4 mb-2"},Q={class:"text-subtitle-1 mb-2"},W={class:"text-body-1"};function X(i,e,a,m,t,d){const U=s("v-img"),v=s("v-card-text"),c=s("v-btn"),h=s("v-card-actions"),P=s("v-card"),V=s("v-col"),y=s("v-toolbar-title"),j=s("v-spacer"),k=s("v-toolbar"),D=s("v-card-title"),S=s("v-chip"),C=s("v-row"),O=s("v-container"),g=s("v-text-field"),N=s("v-file-input"),A=s("v-form"),T=s("v-dialog"),B=s("v-textarea"),R=s("v-combobox");return u(),x("div",null,[o(O,null,{default:r(()=>[o(C,{class:"mb-6"},{default:r(()=>[o(V,{cols:"12",md:"4"},{default:r(()=>[o(P,null,{default:r(()=>[o(U,{src:t.userProfile.avatar,height:"300",cover:""},null,8,["src"]),o(v,null,{default:r(()=>[w("h2",K,p(t.userProfile.firstName+" "+t.userProfile.lastName),1),w("p",Q,p(t.userProfile.email),1),w("p",W,p(t.userProfile.bio),1)]),_:1}),o(h,null,{default:r(()=>[t.isOwner?(u(),f(c,{key:0,color:"primary",variant:"outlined",onClick:e[0]||(e[0]=l=>t.showEditProfile=!0)},{default:r(()=>e[13]||(e[13]=[n(" Edit Profile ")])),_:1,__:[13]})):F("",!0)]),_:1})]),_:1})]),_:1}),o(V,{cols:"12",md:"20"},{default:r(()=>[o(P,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(y,null,{default:r(()=>e[14]||(e[14]=[n("My Projects")])),_:1,__:[14]}),o(j),t.isOwner?(u(),f(c,{key:0,color:"white",variant:"text",onClick:e[1]||(e[1]=l=>t.showNewProject=!0)},{default:r(()=>e[15]||(e[15]=[n(" Add New Project ")])),_:1,__:[15]})):F("",!0)]),_:1}),o(v,null,{default:r(()=>[o(C,null,{default:r(()=>[(u(!0),x(E,null,I(t.userProjects,l=>(u(),f(V,{key:l._id,cols:"12",md:"6"},{default:r(()=>[o(P,null,{default:r(()=>[o(U,{src:l.coverImage,height:"200",cover:""},null,8,["src"]),o(D,null,{default:r(()=>[n(p(l.title),1)]),_:2},1024),o(v,null,{default:r(()=>[w("p",null,p(l.description),1),(u(!0),x(E,null,I(l.tags,b=>(u(),f(S,{key:b,class:"mr-2 mb-2",size:"small"},{default:r(()=>[n(p(b),1)]),_:2},1024))),128))]),_:2},1024),o(h,null,{default:r(()=>[o(c,{color:"primary",variant:"text",to:`/${t.userProfile.username}/${l.id}`},{default:r(()=>e[16]||(e[16]=[n(" View ")])),_:2,__:[16]},1032,["to"]),t.isOwner?(u(),f(c,{key:0,color:"primary",variant:"text",onClick:b=>d.editProject(l)},{default:r(()=>e[17]||(e[17]=[n(" Edit ")])),_:2,__:[17]},1032,["onClick"])):F("",!0),o(j),t.isOwner?(u(),f(c,{key:1,color:"error",variant:"text",onClick:b=>d.deleteProject(l)},{default:r(()=>e[18]||(e[18]=[n(" Delete ")])),_:2,__:[18]},1032,["onClick"])):F("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(T,{modelValue:t.showEditProfile,"onUpdate:modelValue":e[5]||(e[5]=l=>t.showEditProfile=l),"max-width":"500"},{default:r(()=>[o(P,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(y,null,{default:r(()=>e[19]||(e[19]=[n("Edit Profile")])),_:1,__:[19]})]),_:1}),o(v,null,{default:r(()=>[o(A,{onSubmit:z(d.saveProfile,["prevent"])},{default:r(()=>[o(g,{modelValue:t.editForm.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.editForm.name=l),label:"Name",required:""},null,8,["modelValue"]),o(g,{modelValue:t.editForm.bio,"onUpdate:modelValue":e[3]||(e[3]=l=>t.editForm.bio=l),label:"Bio",multiline:"",rows:"3"},null,8,["modelValue"]),o(N,{modelValue:t.editForm.avatar,"onUpdate:modelValue":e[4]||(e[4]=l=>t.editForm.avatar=l),label:"Profile Picture",accept:"image/*","prepend-icon":"mdi-camera"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(h,null,{default:r(()=>[o(j),o(c,{color:"primary",onClick:d.saveProfile,loading:t.loading},{default:r(()=>e[20]||(e[20]=[n(" Save Changes ")])),_:1,__:[20]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(T,{modelValue:t.showNewProject,"onUpdate:modelValue":e[12]||(e[12]=l=>t.showNewProject=l),"max-width":"800"},{default:r(()=>[o(P,null,{default:r(()=>[o(k,{color:"primary",dark:"",flat:""},{default:r(()=>[o(y,null,{default:r(()=>e[21]||(e[21]=[n("Add New Project")])),_:1,__:[21]})]),_:1}),o(v,null,{default:r(()=>[o(A,{onSubmit:z(d.saveProject,["prevent"])},{default:r(()=>[o(g,{modelValue:t.projectForm.title,"onUpdate:modelValue":e[6]||(e[6]=l=>t.projectForm.title=l),label:"Project Title",required:""},null,8,["modelValue"]),o(B,{modelValue:t.projectForm.description,"onUpdate:modelValue":e[7]||(e[7]=l=>t.projectForm.description=l),label:"Project Description",required:""},null,8,["modelValue"]),o(B,{modelValue:t.projectForm.content,"onUpdate:modelValue":e[8]||(e[8]=l=>t.projectForm.content=l),label:"Project Content",required:""},null,8,["modelValue"]),o(N,{modelValue:t.projectForm.coverImage,"onUpdate:modelValue":e[9]||(e[9]=l=>t.projectForm.coverImage=l),label:"Project Cover Image",accept:"image/*","prepend-icon":"mdi-image"},null,8,["modelValue"]),o(R,{modelValue:t.projectForm.tags,"onUpdate:modelValue":e[10]||(e[10]=l=>t.projectForm.tags=l),label:"Tags",multiple:"",chips:"","small-chips":""},null,8,["modelValue"]),o(g,{modelValue:t.projectForm.githubUrl,"onUpdate:modelValue":e[11]||(e[11]=l=>t.projectForm.githubUrl=l),label:"GitHub Repository URL","prepend-icon":"mdi-github"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(h,null,{default:r(()=>[o(j),o(c,{color:"primary",onClick:d.saveProject,loading:t.loading},{default:r(()=>e[22]||(e[22]=[n(" Save Project ")])),_:1,__:[22]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Z=q(J,[["render",X]]);export{Z as default};
