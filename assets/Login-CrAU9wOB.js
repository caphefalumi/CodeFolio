import{_ as b,f as u,o as m,w as l,g as V,d as _,r as t,t as E,C as I,a as i,b as r,n as C,e as p}from"./index-e39HvZBY.js";import{A as M}from"./AppForm-YyapBM-J.js";import{u as q}from"./common-FDs1CWLr.js";const N={name:"VIconLogin",props:{provider:{type:String,required:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},computed:{providerName(){return this.provider}}};function S(o,e,a,f,s,n){const d=t("v-icon"),g=t("v-btn");return m(),u(g,{class:"login-btn",block:"",elevation:"1",loading:a.loading,disabled:a.disabled},{default:l(()=>[a.provider==="google"&&!a.loading?(m(),u(d,{key:0,left:"",class:"me-2 google-icon",color:"#EA4335"})):a.provider==="github"&&!a.loading?(m(),u(d,{key:1,left:"",class:"me-2 github-icon",color:"#4267B2"})):V("",!0),_(" "+E(a.loading?"Logging in...":`Login with ${n.providerName}`),1)]),_:1},8,["loading","disabled"])}const B=b(N,[["render",S],["__scopeId","data-v-75729751"]]),P={components:{GoogleLogin:I,vIconLogin:B,AppForm:M},setup(){const{handleError:o}=q();return{handleError:o}},data(){return{loading:!1,googleLoading:!1,githubLoading:!1,errorMessage:"",form:{email:"",password:""},rules:{required:o=>!!o||"This field is required",email:o=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(o)||"Email must be valid"}}},computed:{isAnyLoading(){return this.loading||this.googleLoading||this.githubLoading}},mounted(){window.addEventListener("message",this.receiveGithubToken)},beforeUnmount(){window.removeEventListener("message",this.receiveGithubToken)},methods:{async handleLogin(){this.errorMessage="",this.loading=!0;try{const o=await p.post("/api/auth/login/jwt",{email:this.form.email,password:this.form.password},{withCredentials:!0});sessionStorage.setItem("accessToken",o.data.accessToken),this.$router.push("/")}catch(o){this.errorMessage=this.handleError(o,"Login failed. Please try again.")}finally{this.loading=!1}},async handleGoogleLogin(o){this.errorMessage="",this.googleLoading=!0;try{const e=await p.post("/api/auth/login/google",{token:o.access_token});sessionStorage.setItem("accessToken",e.data.accessToken),window.location.href="/"}catch(e){this.errorMessage=this.handleError(e,"Google login failed. Please try again.")}finally{this.googleLoading=!1}},handleGithubLogin(){this.errorMessage="",this.githubLoading=!0;const o=window.open("/api/auth/login/github","GitHub Login","width=500,height=600"),e=setInterval(()=>{o.closed&&(clearInterval(e),setTimeout(()=>{this.githubLoading&&(this.githubLoading=!1)},1e3))},1e3)},receiveGithubToken(o){if(o.origin!=="http://localhost:3000")return;const{accessToken:e,error:a}=o.data||{};e?(sessionStorage.setItem("accessToken",e),window.location.href="/"):a&&(this.errorMessage=a,window.location.reload()),this.githubLoading=!1}}},U={class:"login-buttons"},j={class:"login-btn-wrapper"},D={class:"text-center mt-4"};function O(o,e,a,f,s,n){const d=t("v-card-title"),g=t("v-text-field"),v=t("app-form"),L=t("v-divider"),h=t("v-icon-login"),w=t("GoogleLogin"),y=t("router-link"),k=t("v-card-text"),x=t("v-card"),A=t("v-col"),T=t("v-row"),G=t("v-container");return m(),u(G,null,{default:l(()=>[i(T,{justify:"center"},{default:l(()=>[i(A,{cols:"12",sm:"8",md:"6"},{default:l(()=>[i(x,{class:"mt-8"},{default:l(()=>[i(d,{class:"text-h4 text-center pt-6",id:"login-heading"},{default:l(()=>e[3]||(e[3]=[_("Login")])),_:1,__:[3]}),i(k,null,{default:l(()=>[i(v,{loading:s.loading,"error-message":s.errorMessage,"submit-button-text":"Login","submit-button-block":!0,"submit-button-class":"mt-4","aria-labelled-by":"login-heading",disabled:n.isAnyLoading,onSubmit:n.handleLogin},{default:l(()=>[i(g,{modelValue:s.form.email,"onUpdate:modelValue":e[0]||(e[0]=c=>s.form.email=c),label:"Email",type:"email",required:"",rules:[s.rules.required,s.rules.email],autocomplete:"email",disabled:n.isAnyLoading},null,8,["modelValue","rules","disabled"]),i(g,{modelValue:s.form.password,"onUpdate:modelValue":e[1]||(e[1]=c=>s.form.password=c),label:"Password",type:"password",required:"",rules:[s.rules.required],autocomplete:"current-password",disabled:n.isAnyLoading},null,8,["modelValue","rules","disabled"])]),_:1},8,["loading","error-message","disabled","onSubmit"]),i(L,{class:"my-4","aria-hidden":"true"}),e[5]||(e[5]=r("div",{class:"text-center text-body-2 mb-2"},[r("span",null,"Or login with")],-1)),r("div",U,[i(w,{callback:n.handleGoogleLogin,"auto-login":"","popup-type":"TOKEN",disabled:n.isAnyLoading},{default:l(()=>[i(h,{provider:"google",loading:s.googleLoading,disabled:n.isAnyLoading},null,8,["loading","disabled"])]),_:1},8,["callback","disabled"]),r("div",j,[i(h,{provider:"github",loading:s.githubLoading,disabled:n.isAnyLoading,onClick:e[2]||(e[2]=c=>!n.isAnyLoading&&n.handleGithubLogin())},null,8,["loading","disabled"])])]),r("div",D,[i(y,{to:"/register",class:C(["text-decoration-none",{"pointer-events-none text-grey":n.isAnyLoading}])},{default:l(()=>e[4]||(e[4]=[_(" Don't have an account? Register ")])),_:1,__:[4]},8,["class"])])]),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1})}const K=b(P,[["render",O],["__scopeId","data-v-72f0279b"]]);export{K as default};
